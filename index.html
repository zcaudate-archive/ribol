<html><head><meta content="chrome=1" http-equiv="X-UA-Compatible" /><meta charset="utf-8" /><meta content="width=device-width, initial-scale=1, user-scalable=no" name="viewport" /><title>ribol</title><style>body {
  padding:50px;
  font:14px/1.5 Helvetica, Arial, sans-serif;
  color:#777;
  font-weight:300;
}

h1, h2, h3, h4, h5, h6 {
  color:#222;
  margin:0 0 20px;
}

p, ul, ol, table, pre, dl {
  margin:0 0 20px;
}

h1, h2, h3 {
  line-height:1.1;
}

h1 {
  font-size:28px;
}

h2 {
  color:#393939;
}

h4, h5, h6 {
  color:#494949;
  margin:0;
}

header h4{
  margin: 10 0 0 0px;
}

a {
  color:#39c;
  font-weight:400;
  text-decoration:none;
}

a small {
  font-size:11px;
  color:#777;
  margin-top:-0.6em;
  display:block;
}

.wrapper {
  width:860px;
  margin:0 auto;
}

.figure div.img {
  text-align: center;
  border-radius: 5px;
  border: 1px solid #ddd;
  padding: 10px;
}

blockquote {
  border-left:1px solid #e5e5e5;
  margin:0;
  padding:0 0 0 20px;
  font-style:italic;
}

code, pre {
  font-family:Monaco, Bitstream Vera Sans Mono, Lucida Console, Terminal;
  color:#333;
  font-size:12px;
}

pre {
  padding:8px 15px;
  background: #f8f8f8;  
  border-radius:5px;
  border:1px solid #e5e5e5;
  overflow-x: auto;
}

table {
  width:100%;
  border-collapse:collapse;
}

th, td {
  text-align:left;
  padding:5px 10px;
  border-bottom:1px solid #e5e5e5;
}

dt {
  color:#444;
  font-weight:700;
}

th {
  color:#444;
}

img {
  max-width:100%;
}

header {
  width:270px;
  float:left;
  /*position:fixed;*/
}

header ul {
  list-style:none;
  height:40px;
  
  padding:0;
  
  background: #eee;
  background: -moz-linear-gradient(top, #f8f8f8 0%, #dddddd 100%);
  background: -webkit-gradient(linear, left top, left bottom, color-stop(0%,#f8f8f8), color-stop(100%,#dddddd));
  background: -webkit-linear-gradient(top, #f8f8f8 0%,#dddddd 100%);
  background: -o-linear-gradient(top, #f8f8f8 0%,#dddddd 100%);
  background: -ms-linear-gradient(top, #f8f8f8 0%,#dddddd 100%);
  background: linear-gradient(top, #f8f8f8 0%,#dddddd 100%);
  
  border-radius:5px;
  border:1px solid #d2d2d2;
  box-shadow:inset #fff 0 1px 0, inset rgba(0,0,0,0.03) 0 -1px 0;
  width:270px;
}

header li {
  width:89px;
  float:left;
  border-right:1px solid #d2d2d2;
  height:40px;
}

header ul a {
  line-height:1;
  font-size:11px;
  color:#999;
  display:block;
  text-align:center;
  padding-top:6px;
  height:40px;
}

strong {
  font-weight:700;
}

header ul li + li {
  width:88px;
  border-left:1px solid #fff;
}

header ul li + li + li {
  border-right:none;
  width:89px;
}

header ul a strong {
  font-size:14px;
  display:block;
  color:#222;
}

section {
  width: 60%;
  float:right;
  padding-bottom:50px;
  padding-right: 10%;
}

small {
  font-size:11px;
}

hr {
  border:0;
  background:#e5e5e5;
  height:1px;
  margin:0 0 20px;
}

footer {
  width:270px;
  float:left;
  position:fixed;
  bottom:50px;
}

header div.heading {
  display:none;
}


@media print, screen and (max-width: 960px) {
  
  div.wrapper {
    width:auto;
    margin:0;
  }
  
  header, section, footer {
    float:none;
    position:static;
    width:auto;
  }
  
  header div.heading {
    display:block;
  }
    
  section div.heading {
    display:none;
  }
  
  section {
    border:1px solid #e5e5e5;
    border-width:1px 0;
    padding:20px 0;
    margin:0 0 20px;
  }
  
  header a small {
    display:inline;
  }
  
  header ul {
    position:absolute;
    right:50px;
    top:52px;
  }
}

@media print, screen and (max-width: 720px) {
  body {
    word-wrap:break-word;
  }
  
  header {
    padding:0;
  }
  
  header ul, header p.view {
    position:static;
  }
  
  pre, code {
    word-wrap:normal;
  }
}

@media print, screen and (max-width: 480px) {
  body {
    padding:15px;
  }
  
  header ul {
    display:none;
  }
}

@media print {
  body {
    padding:0.4in;
    font-size:12pt;
    color:#444;
  }
}


.highlight  { background: #ffffff; }
.highlight .c { color: #999988; font-style: italic } /* Comment */
.highlight .err { color: #a61717; background-color: #e3d2d2 } /* Error */
.highlight .k { font-weight: bold } /* Keyword */
.highlight .o { font-weight: bold } /* Operator */
.highlight .cm { color: #999988; font-style: italic } /* Comment.Multiline */
.highlight .cp { color: #999999; font-weight: bold } /* Comment.Preproc */
.highlight .c1 { color: #999988; font-style: italic } /* Comment.Single */
.highlight .cs { color: #999999; font-weight: bold; font-style: italic } /* Comment.Special */
.highlight .gd { color: #000000; background-color: #ffdddd } /* Generic.Deleted */
.highlight .gd .x { color: #000000; background-color: #ffaaaa } /* Generic.Deleted.Specific */
.highlight .ge { font-style: italic } /* Generic.Emph */
.highlight .gr { color: #aa0000 } /* Generic.Error */
.highlight .gh { color: #999999 } /* Generic.Heading */
.highlight .gi { color: #000000; background-color: #ddffdd } /* Generic.Inserted */
.highlight .gi .x { color: #000000; background-color: #aaffaa } /* Generic.Inserted.Specific */
.highlight .go { color: #888888 } /* Generic.Output */
.highlight .gp { color: #555555 } /* Generic.Prompt */
.highlight .gs { font-weight: bold } /* Generic.Strong */
.highlight .gu { color: #800080; font-weight: bold; } /* Generic.Subheading */
.highlight .gt { color: #aa0000 } /* Generic.Traceback */
.highlight .kc { font-weight: bold } /* Keyword.Constant */
.highlight .kd { font-weight: bold } /* Keyword.Declaration */
.highlight .kn { font-weight: bold } /* Keyword.Namespace */
.highlight .kp { font-weight: bold } /* Keyword.Pseudo */
.highlight .kr { font-weight: bold } /* Keyword.Reserved */
.highlight .kt { color: #445588; font-weight: bold } /* Keyword.Type */
.highlight .m { color: #009999 } /* Literal.Number */
.highlight .s { color: #d14 } /* Literal.String */
.highlight .na { color: #008080 } /* Name.Attribute */
.highlight .nb { color: #0086B3 } /* Name.Builtin */
.highlight .nc { color: #445588; font-weight: bold } /* Name.Class */
.highlight .no { color: #008080 } /* Name.Constant */
.highlight .ni { color: #800080 } /* Name.Entity */
.highlight .ne { color: #990000; font-weight: bold } /* Name.Exception */
.highlight .nf { color: #990000; font-weight: bold } /* Name.Function */
.highlight .nn { color: #555555 } /* Name.Namespace */
.highlight .nt { color: #000080 } /* Name.Tag */
.highlight .nv { color: #008080 } /* Name.Variable */
.highlight .ow { font-weight: bold } /* Operator.Word */
.highlight .w { color: #bbbbbb } /* Text.Whitespace */
.highlight .mf { color: #009999 } /* Literal.Number.Float */
.highlight .mh { color: #009999 } /* Literal.Number.Hex */
.highlight .mi { color: #009999 } /* Literal.Number.Integer */
.highlight .mo { color: #009999 } /* Literal.Number.Oct */
.highlight .sb { color: #d14 } /* Literal.String.Backtick */
.highlight .sc { color: #d14 } /* Literal.String.Char */
.highlight .sd { color: #d14 } /* Literal.String.Doc */
.highlight .s2 { color: #d14 } /* Literal.String.Double */
.highlight .se { color: #d14 } /* Literal.String.Escape */
.highlight .sh { color: #d14 } /* Literal.String.Heredoc */
.highlight .si { color: #d14 } /* Literal.String.Interpol */
.highlight .sx { color: #d14 } /* Literal.String.Other */
.highlight .sr { color: #009926 } /* Literal.String.Regex */
.highlight .s1 { color: #d14 } /* Literal.String.Single */
.highlight .ss { color: #990073 } /* Literal.String.Symbol */
.highlight .bp { color: #999999 } /* Name.Builtin.Pseudo */
.highlight .vc { color: #008080 } /* Name.Variable.Class */
.highlight .vg { color: #008080 } /* Name.Variable.Global */
.highlight .vi { color: #008080 } /* Name.Variable.Instance */
.highlight .il { color: #009999 } /* Literal.Number.Integer.Long */

.type-csharp .highlight .k { color: #0000FF }
.type-csharp .highlight .kt { color: #0000FF }
.type-csharp .highlight .nf { color: #000000; font-weight: normal }
.type-csharp .highlight .nc { color: #2B91AF }
.type-csharp .highlight .nn { color: #000000 }
.type-csharp .highlight .s { color: #A31515 }
.type-csharp .highlight .sc { color: #A31515 }


</style></head><body><header><div class="heading"><h1>ribol</h1><h3>conditional restarts for clojure</h3><hr /><div class="info"><h5>Author: Chris Zheng<b>&nbsp;&nbsp;<a href="mailto:z@caudate.me">(z@caudate.me)</a></b></h5><h5>Library: v0.3.3</h5><h5>Date: 25 October 2013</h5><h5>Website: <a href="http://www.github.com/zcaudate/ribol">http://www.github.com/zcaudate/ribol</a></h5><h5>Generated By: <a href="http://www.github.com/zcaudate/lein-midje-doc">MidjeDoc</a></h5></div><br /><hr /></div><h4><a href="#overview">1 &nbsp; Overview</a></h4><h5>&nbsp;&nbsp;<i><a href="#installation">1.1 &nbsp; Installation</a></i></h5><h4><a href="#unlucky-numbers">2 &nbsp; Unlucky Numbers</a></h4><h4><a href="#conditional-restarts">3 &nbsp; Conditional Restarts</a></h4><h5>&nbsp;&nbsp;<i><a href="#raising-issues">3.1 &nbsp; Raising issues</a></i></h5><h5>&nbsp;&nbsp;<i><a href="#managing-issues">3.2 &nbsp; Managing issues</a></i></h5><h4><a href="#api-reference">4 &nbsp; API Reference</a></h4><h5>&nbsp;&nbsp;<i><a href="#api-raise">4.1 &nbsp; raise</a></i></h5><h5>&nbsp;&nbsp;&nbsp;&nbsp;<i><a href="#hash-map">4.1.1 &nbsp; hash-map</a></i></h5><h5>&nbsp;&nbsp;&nbsp;&nbsp;<i><a href="#keyword">4.1.2 &nbsp; keyword</a></i></h5><h5>&nbsp;&nbsp;&nbsp;&nbsp;<i><a href="#vector">4.1.3 &nbsp; vector</a></i></h5><h5>&nbsp;&nbsp;&nbsp;&nbsp;<i><a href="#option/default">4.1.4 &nbsp; option/default</a></i></h5><h5>&nbsp;&nbsp;<i><a href="#manage/on">4.2 &nbsp; manage/on</a></i></h5><h5>&nbsp;&nbsp;&nbsp;&nbsp;<i><a href="#checkers">4.2.1 &nbsp; checkers</a></i></h5><h5>&nbsp;&nbsp;&nbsp;&nbsp;<i><a href="#bindings">4.2.2 &nbsp; bindings</a></i></h5><h5>&nbsp;&nbsp;&nbsp;&nbsp;<i><a href="#catch-and-finally">4.2.3 &nbsp; catch and finally</a></i></h5><h5>&nbsp;&nbsp;<i><a href="#special-forms">4.3 &nbsp; special forms</a></i></h5><h5>&nbsp;&nbsp;&nbsp;&nbsp;<i><a href="#api-continue">4.3.1 &nbsp; continue</a></i></h5><h5>&nbsp;&nbsp;&nbsp;&nbsp;<i><a href="#api-fail">4.3.2 &nbsp; fail</a></i></h5><h5>&nbsp;&nbsp;&nbsp;&nbsp;<i><a href="#api-choose">4.3.3 &nbsp; choose</a></i></h5><h5>&nbsp;&nbsp;&nbsp;&nbsp;<i><a href="#api-default">4.3.4 &nbsp; default</a></i></h5><h5>&nbsp;&nbsp;&nbsp;&nbsp;<i><a href="#api-escalate">4.3.5 &nbsp; escalate</a></i></h5><h5>&nbsp;&nbsp;<i><a href="#hooks">4.4 &nbsp; hooks</a></i></h5><h5>&nbsp;&nbsp;&nbsp;&nbsp;<i><a href="#raise-on">4.4.1 &nbsp; raise-on</a></i></h5><h5>&nbsp;&nbsp;&nbsp;&nbsp;<i><a href="#raise-on-all">4.4.2 &nbsp; raise-on-all</a></i></h5><h5>&nbsp;&nbsp;&nbsp;&nbsp;<i><a href="#anticipate">4.4.3 &nbsp; anticipate</a></i></h5><h4><a href="#control-strategies">5 &nbsp; Control Strategies</a></h4><h5>&nbsp;&nbsp;<i><a href="#normal">5.1 &nbsp; Normal</a></i></h5><h5>&nbsp;&nbsp;&nbsp;&nbsp;<i><a href="#no-raise">5.1.1 &nbsp; No Raise</a></i></h5><h5>&nbsp;&nbsp;&nbsp;&nbsp;<i><a href="#issue-raised">5.1.2 &nbsp; Issue Raised</a></i></h5><h5>&nbsp;&nbsp;<i><a href="#catch">5.2 &nbsp; Catch</a></i></h5><h5>&nbsp;&nbsp;&nbsp;&nbsp;<i><a href="#first-level-catch">5.2.1 &nbsp; First Level Catch</a></i></h5><h5>&nbsp;&nbsp;&nbsp;&nbsp;<i><a href="#second-level-catch">5.2.2 &nbsp; Second Level Catch</a></i></h5><h5>&nbsp;&nbsp;<i><a href="#continue">5.3 &nbsp; Continue</a></i></h5><h5>&nbsp;&nbsp;&nbsp;&nbsp;<i><a href="#first-level-continue">5.3.1 &nbsp; First Level Continue</a></i></h5><h5>&nbsp;&nbsp;&nbsp;&nbsp;<i><a href="#second-level-continue">5.3.2 &nbsp; Second Level Continue</a></i></h5><h5>&nbsp;&nbsp;<i><a href="#choose">5.4 &nbsp; Choose</a></i></h5><h5>&nbsp;&nbsp;&nbsp;&nbsp;<i><a href="#choose-lower-level">5.4.1 &nbsp; Choose Lower-Level</a></i></h5><h5>&nbsp;&nbsp;&nbsp;&nbsp;<i><a href="#choose-upper-level">5.4.2 &nbsp; Choose Upper-Level</a></i></h5><h5>&nbsp;&nbsp;<i><a href="#choose-more">5.5 &nbsp; Choose - More Strategies</a></i></h5><h5>&nbsp;&nbsp;&nbsp;&nbsp;<i><a href="#overridding-an-option">5.5.1 &nbsp; Overridding An Option</a></i></h5><h5>&nbsp;&nbsp;&nbsp;&nbsp;<i><a href="#default-option">5.5.2 &nbsp; Default Option</a></i></h5><h5>&nbsp;&nbsp;&nbsp;&nbsp;<i><a href="#overriding-defaults">5.5.3 &nbsp; Overriding Defaults</a></i></h5><h5>&nbsp;&nbsp;<i><a href="#escalate">5.6 &nbsp; Escalate</a></i></h5><h5>&nbsp;&nbsp;&nbsp;&nbsp;<i><a href="#simple-escalation">5.6.1 &nbsp; Simple Escalation</a></i></h5><h5>&nbsp;&nbsp;&nbsp;&nbsp;<i><a href="#escalation-with-options">5.6.2 &nbsp; Escalation with Options</a></i></h5><h5>&nbsp;&nbsp;<i><a href="#fail">5.7 &nbsp; Fail</a></i></h5><h5>&nbsp;&nbsp;<i><a href="#default">5.8 &nbsp; Default</a></i></h5><h5>&nbsp;&nbsp;&nbsp;&nbsp;<i><a href="#escalation-with-defaults">5.8.1 &nbsp; Escalation with Defaults</a></i></h5><h5>&nbsp;&nbsp;<i><a href="#on-form">5.9 &nbsp; Branch Using On</a></i></h5><h4><a href="#implementation">6 &nbsp; Implementation</a></h4><h5>&nbsp;&nbsp;<i><a href="#the-workplace">6.1 &nbsp; The Workplace</a></i></h5><h5>&nbsp;&nbsp;&nbsp;&nbsp;<i><a href="#the-dumb-throw">6.1.1 &nbsp; The dumb throw</a></i></h5><h5>&nbsp;&nbsp;&nbsp;&nbsp;<i><a href="#the-smart-raise">6.1.2 &nbsp; The smart raise</a></i></h5><h5>&nbsp;&nbsp;&nbsp;&nbsp;<i><a href="#the-proactive-workplace">6.1.3 &nbsp; The proactive workplace</a></i></h5><h5>&nbsp;&nbsp;<i><a href="#the-issue-management-board">6.2 &nbsp; The Issue Management Board</a></i></h5><h5>&nbsp;&nbsp;&nbsp;&nbsp;<i><a href="#control-flow-as-data">6.2.1 &nbsp; Control Flow as Data</a></i></h5><h5>&nbsp;&nbsp;&nbsp;&nbsp;<i><a href="#implementing-catch">6.2.2 &nbsp; Implementing Catch</a></i></h5><h5>&nbsp;&nbsp;&nbsp;&nbsp;<i><a href="#implementing-choose">6.2.3 &nbsp; Implementing Choose</a></i></h5><h5>&nbsp;&nbsp;&nbsp;&nbsp;<i><a href="#implementing-the-rest">6.2.4 &nbsp; Implementing the Rest</a></i></h5><h4><a href="#end-notes">7 &nbsp; End Notes</a></h4><br /></header><section><div class="heading"><h1>ribol</h1><h3>conditional restarts for clojure</h3><hr /><div class="info"><h5>Author: Chris Zheng<b>&nbsp;&nbsp;<a href="mailto:z@caudate.me">(z@caudate.me)</a></b></h5><h5>Library: v0.3.3</h5><h5>Date: 25 October 2013</h5><h5>Website: <a href="http://www.github.com/zcaudate/ribol">http://www.github.com/zcaudate/ribol</a></h5><h5>Generated By: <a href="http://www.github.com/zcaudate/lein-midje-doc">MidjeDoc</a></h5></div><br /><hr /></div><div><a name="overview"></a><h2><b>1 &nbsp;&nbsp; Overview</b></h2></div><div><p>This is quite a comprehensive guide to <code>ribol</code> and how conditional restart libraries may be used. There are currently three other conditional restart libraries for clojure:</p><ul><li><a href='https://github.com/richhickey/clojure-contrib/blob/master/src/main/clojure/clojure/contrib/error&#95;kit.clj'>errorkit</a> was the first and provided the guiding architecture for this library.<p></li></ul><ul><li><a href='https://github.com/hugoduncan/swell'>swell</a> and <a href='https://github.com/bwo/conditions'>conditions</a> have been written to work with <a href='https://github.com/scgilardi/slingshot'>slingshot</a>.</li></ul>A simple use case looking at the advantage in using restarts over exceptions can be seen in <a href='#unlucky-numbers'>Unlucky Numbers</a>. There is also a <a href='#api-reference'>Core library API</a> with examples.</p><p>For those that wish to know more about conditional restarts, a comparison of different strategies that can be implemented is done in <a href='#control-strategies'>Control Strategies</a>. While for those curious about how this jumping around has been achieved, look at <a href='#implementation'>Implementation</a>.</p></div><div><a name="installation"></a><h3>1.1 &nbsp;&nbsp; Installation</h3></div><div><p>In <code>project.clj</code>, add to dependencies:</p></div><div><div class="highlight"><pre><span class="p">[</span><span class="nv">im.chit/ribol</span> <span class="s">&quot;0.3.3&quot;</span><span class="p">]</span>
</pre></div>
</div><div><p>All functionality is found contained in <code>ribol.core</code></p></div><div><div class="highlight"><pre><span class="p">(</span><span class="nf">use</span> <span class="ss">&#39;ribol.core</span><span class="p">)</span>
</pre></div>
</div><div><a name="unlucky-numbers"></a><h2><b>2 &nbsp;&nbsp; Unlucky Numbers</b></h2></div><div><p>In this demonstration, we look at how code bloat problems using <code>throw/try/catch</code> could be reduced using <code>raise/manage/on</code>. Two functions are defined:<ul><li><code>check-unlucky</code> which takes a number as input, throwing a <code>RuntimeException</code> when it sees an unlucky number.</li><li><code>int-to-str</code> which calls <code>check-unlucky</code>, pretends to do work and outputs a string represention of the number.</li></ul></div><div><div class="highlight"><pre><span class="p">(</span><span class="kd">defn </span><span class="nv">check-unlucky</span> <span class="p">[</span><span class="nv">n</span><span class="p">]</span>
  <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="o">#</span><span class="p">{</span><span class="mi">4</span> <span class="mi">13</span> <span class="mi">14</span> <span class="mi">24</span> <span class="mi">666</span><span class="p">}</span> <span class="nv">n</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">throw</span> <span class="p">(</span><span class="nf">RuntimeException.</span> <span class="s">&quot;Unlucky Number&quot;</span><span class="p">))</span>
    <span class="nv">n</span><span class="p">))</span>

<span class="p">(</span><span class="kd">defn </span><span class="nv">int-to-str</span> <span class="p">[</span><span class="nv">n</span><span class="p">]</span>
  <span class="p">(</span><span class="k">do </span><span class="p">(</span><span class="nf">Thread/sleep</span> <span class="mi">10</span><span class="p">)</span>  <span class="c1">;; Work out something</span>
      <span class="p">(</span><span class="nb">str </span><span class="p">(</span><span class="nf">check-unlucky</span> <span class="nv">n</span><span class="p">))))</span>
</pre></div>
</div><div><div class="highlight"><pre><span class="p">(</span><span class="nf">int-to-str</span> <span class="mi">1</span><span class="p">)</span> <span class="nv">=&gt;</span> <span class="s">&quot;1&quot;</span>

<span class="p">(</span><span class="nf">int-to-str</span> <span class="mi">666</span><span class="p">)</span> <span class="nv">=&gt;</span> <span class="p">(</span><span class="nf">throws</span> <span class="nv">RuntimeException</span> <span class="s">&quot;Unlucky Number&quot;</span><span class="p">)</span>
</pre></div>
</div><div><p>We can then use <code>int-to-str</code> to run across multiple numbers:</p></div><div><div class="highlight"><pre><span class="p">(</span><span class="nf">mapv</span> <span class="nv">int-to-str</span> <span class="p">(</span><span class="nb">range </span><span class="mi">4</span><span class="p">))</span>
<span class="nv">=&gt;</span> <span class="p">[</span><span class="s">&quot;0&quot;</span> <span class="s">&quot;1&quot;</span> <span class="s">&quot;2&quot;</span> <span class="s">&quot;3&quot;</span><span class="p">]</span>
</pre></div>
</div><div><p><h4>Exceptions mess up the middle</h4></p><p>Except when we try to use it in with a sequence containing an unlucky number</p></div><div><div class="highlight"><pre><span class="p">(</span><span class="nf">mapv</span> <span class="nv">int-to-str</span> <span class="p">(</span><span class="nb">range </span><span class="mi">20</span><span class="p">))</span>

<span class="nv">=&gt;</span> <span class="p">(</span><span class="nf">throws</span> <span class="nv">RuntimeException</span> <span class="s">&quot;Unlucky Number&quot;</span><span class="p">)</span>
</pre></div>
</div><div><p>We can try and recover using <code>try/catch</code></p></div><div><div class="highlight"><pre><span class="p">(</span><span class="nf">try</span>
  <span class="p">(</span><span class="nf">mapv</span> <span class="nv">int-to-str</span> <span class="p">(</span><span class="nb">range </span><span class="mi">20</span><span class="p">))</span>
  <span class="p">(</span><span class="nf">catch</span> <span class="nv">RuntimeException</span> <span class="nv">e</span>
    <span class="s">&quot;Unlucky number in the sequence&quot;</span><span class="p">))</span>

<span class="nv">=&gt;</span> <span class="s">&quot;Unlucky number in the sequence&quot;</span>
</pre></div>
</div><div><p>But we can never get the previous sequence back again because we have blown the stack. The only way to 'fix' this problem is to change <code>int-to-str</code> so that it catches the exception:</p></div><div><div class="highlight"><pre><span class="p">(</span><span class="kd">defn </span><span class="nv">int-to-str-fix</span> <span class="p">[</span><span class="nv">n</span><span class="p">]</span>
  <span class="p">(</span><span class="nf">try</span>
    <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nf">check-unlucky</span> <span class="nv">n</span><span class="p">)</span>    <span class="c1">;;</span>
      <span class="p">(</span><span class="k">do </span><span class="p">(</span><span class="nf">Thread/sleep</span> <span class="mi">10</span><span class="p">)</span>  <span class="c1">;; Work out something</span>
          <span class="p">(</span><span class="nb">str </span><span class="nv">n</span><span class="p">)))</span>
    <span class="p">(</span><span class="nf">catch</span> <span class="nv">RuntimeException</span> <span class="nv">e</span>
      <span class="s">&quot;-&quot;</span><span class="p">)))</span>

<span class="p">(</span><span class="nf">mapv</span> <span class="nv">int-to-str-fix</span> <span class="p">(</span><span class="nb">range </span><span class="mi">20</span><span class="p">))</span>
<span class="nv">=&gt;</span> <span class="p">[</span><span class="s">&quot;0&quot;</span> <span class="s">&quot;1&quot;</span> <span class="s">&quot;2&quot;</span> <span class="s">&quot;3&quot;</span> <span class="s">&quot;-&quot;</span> <span class="s">&quot;5&quot;</span> <span class="s">&quot;6&quot;</span> <span class="s">&quot;7&quot;</span> <span class="s">&quot;8&quot;</span> <span class="s">&quot;9&quot;</span> <span class="s">&quot;10&quot;</span>
    <span class="s">&quot;11&quot;</span> <span class="s">&quot;12&quot;</span> <span class="s">&quot;-&quot;</span> <span class="s">&quot;-&quot;</span> <span class="s">&quot;15&quot;</span> <span class="s">&quot;16&quot;</span> <span class="s">&quot;17&quot;</span> <span class="s">&quot;18&quot;</span> <span class="s">&quot;19&quot;</span><span class="p">]</span>
</pre></div>
</div><div><p>This is seriously unattractive code. We have doubled our line-count to <code>int-to-str</code> without adding too much functionality.</p><p>For real world scenarios like batch processing a bunch of files, there are more ways that the program can go wrong. The middle code becomes messy very quickly.</p></div><div><p><h4>Raising issues, not throwing exceptions</h4></p><p>This problem actually has a very elegant solution if we use <code>ribol</code>. Instead of throwing an exception, we can <code>raise</code> an issue in <code>check-unlucky</code>:</p></div><div><div class="highlight"><pre><span class="p">(</span><span class="kd">defn </span><span class="nv">check-unlucky</span> <span class="p">[</span><span class="nv">n</span><span class="p">]</span>
  <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="o">#</span><span class="p">{</span><span class="mi">4</span> <span class="mi">13</span> <span class="mi">14</span> <span class="mi">24</span> <span class="mi">666</span><span class="p">}</span> <span class="nv">n</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">raise</span> <span class="p">[</span><span class="ss">:unlucky-number</span> <span class="p">{</span><span class="ss">:value</span> <span class="nv">n</span><span class="p">}])</span>
    <span class="nv">n</span><span class="p">))</span>
</pre></div>
</div><div><p><code>int-to-str</code> does not have to change</p></div><div><div class="highlight"><pre><span class="p">(</span><span class="kd">defn </span><span class="nv">int-to-str</span> <span class="p">[</span><span class="nv">n</span><span class="p">]</span>
  <span class="p">(</span><span class="k">do </span><span class="p">(</span><span class="nf">Thread/sleep</span> <span class="mi">10</span><span class="p">)</span>  <span class="c1">;; Work out something</span>
      <span class="p">(</span><span class="nb">str </span><span class="p">(</span><span class="nf">check-unlucky</span> <span class="nv">n</span><span class="p">))))</span>
</pre></div>
</div><div><p>We still get the same functionality:</p></div><div><div class="highlight"><pre><span class="p">(</span><span class="nf">int-to-str</span> <span class="mi">1</span><span class="p">)</span> <span class="nv">=&gt;</span> <span class="s">&quot;1&quot;</span>

<span class="p">(</span><span class="nf">mapv</span> <span class="nv">int-to-str</span> <span class="p">(</span><span class="nb">range </span><span class="mi">4</span><span class="p">))</span>
<span class="nv">=&gt;</span> <span class="p">[</span><span class="s">&quot;0&quot;</span> <span class="s">&quot;1&quot;</span> <span class="s">&quot;2&quot;</span> <span class="s">&quot;3&quot;</span><span class="p">]</span>
</pre></div>
</div><div><p><h4>Handling raised issues</h4></p><p>What happens when we use this with unlucky numbers? Its almost the same... except that instead of raising a <code>RuntimeException</code>, we get a <code>clojure.lang.ExceptionInfo</code> object:</p></div><div><div class="highlight"><pre><span class="p">(</span><span class="nf">mapv</span> <span class="nv">int-to-str</span> <span class="p">(</span><span class="nb">range </span><span class="mi">20</span><span class="p">))</span>
<span class="nv">=&gt;</span> <span class="p">(</span><span class="nf">throws</span> <span class="nv">clojure.lang.ExceptionInfo</span><span class="p">)</span>
</pre></div>
</div><div><p>We can still use <code>try/catch</code> to recover from the error</p></div><div><div class="highlight"><pre><span class="p">(</span><span class="nf">try</span>
  <span class="p">(</span><span class="nf">mapv</span> <span class="nv">int-to-str</span> <span class="p">(</span><span class="nb">range </span><span class="mi">20</span><span class="p">))</span>
  <span class="p">(</span><span class="nf">catch</span> <span class="nv">clojure.lang.ExceptionInfo</span> <span class="nv">e</span>
    <span class="s">&quot;Unlucky number in the sequence&quot;</span><span class="p">))</span>
<span class="nv">=&gt;</span> <span class="s">&quot;Unlucky number in the sequence&quot;</span>
</pre></div>
</div><div><p>We set up the <code>ribol</code> handlers by replacing <code>try</code> with <code>manage</code> and <code>catch</code> with <code>on</code>. This gives the exact same result as before.</p></div><div><div class="highlight"><pre><span class="p">(</span><span class="nf">manage</span>
  <span class="p">(</span><span class="nf">mapv</span> <span class="nv">int-to-str</span> <span class="p">(</span><span class="nb">range </span><span class="mi">20</span><span class="p">))</span>
  <span class="p">(</span><span class="nf">on</span> <span class="ss">:unlucky-number</span> <span class="p">[]</span>
    <span class="s">&quot;Unlucky number in the sequence&quot;</span><span class="p">))</span>
<span class="nv">=&gt;</span> <span class="s">&quot;Unlucky number in the sequence&quot;</span>
</pre></div>
</div><div><p><h4>A sleight of code</h4></p><p>However, the whole point of this example is that we wish to keep the previous results without ever changing <code>int-to-str</code>. We will do this with <code>continue</code>:</p></div><div><div class="highlight"><pre><span class="p">(</span><span class="nf">manage</span>
  <span class="p">(</span><span class="nf">mapv</span> <span class="nv">int-to-str</span> <span class="p">(</span><span class="nb">range </span><span class="mi">20</span><span class="p">))</span>
  <span class="p">(</span><span class="nf">on</span> <span class="ss">:unlucky-number</span> <span class="p">[]</span>
      <span class="p">(</span><span class="nf">continue</span> <span class="s">&quot;-&quot;</span><span class="p">)))</span>
<span class="nv">=&gt;</span> <span class="p">[</span><span class="s">&quot;0&quot;</span> <span class="s">&quot;1&quot;</span> <span class="s">&quot;2&quot;</span> <span class="s">&quot;3&quot;</span> <span class="s">&quot;-&quot;</span> <span class="s">&quot;5&quot;</span> <span class="s">&quot;6&quot;</span> <span class="s">&quot;7&quot;</span> <span class="s">&quot;8&quot;</span> <span class="s">&quot;9&quot;</span> <span class="s">&quot;10&quot;</span>
    <span class="s">&quot;11&quot;</span> <span class="s">&quot;12&quot;</span> <span class="s">&quot;-&quot;</span> <span class="s">&quot;-&quot;</span> <span class="s">&quot;15&quot;</span> <span class="s">&quot;16&quot;</span> <span class="s">&quot;17&quot;</span> <span class="s">&quot;18&quot;</span> <span class="s">&quot;19&quot;</span><span class="p">]</span>
</pre></div>
</div><div><p><h4>What just happened?</h4></p><p><code>continue</code> is a special form that allows higher level functions to jump back into the place where the exception was called. So once the manage block was notified of the issue raised in <code>check-unlucky</code>, it did not blow away the stack but jumped back to the back at which the issue was raised and continued on with <code>-</code> instead. In this way, the exception handling code instead of being written in <code>int-to-str</code>, can now be written at the level that it is required.</p></div><div><p><h4>Unlucky for whom?</h4></p><p>The chinese don't like the number 4 and any number with the number 4, but they don't mind 13 and 666. We can write use the <code>on</code> handler to define cases to process:</p></div><div><div class="highlight"><pre><span class="p">(</span><span class="kd">defn </span><span class="nv">ints-to-strs-chinese</span> <span class="p">[</span><span class="nv">arr</span><span class="p">]</span>
  <span class="p">(</span><span class="nf">manage</span>
   <span class="p">(</span><span class="nf">mapv</span> <span class="nv">int-to-str</span> <span class="nv">arr</span><span class="p">)</span>
   <span class="p">(</span><span class="nf">on</span> <span class="p">{</span><span class="ss">:unlucky-number</span> <span class="nv">true</span>
        <span class="ss">:value</span> <span class="o">#</span><span class="p">(</span><span class="nb">or </span><span class="p">(</span><span class="nb">= </span><span class="nv">%</span> <span class="mi">666</span><span class="p">)</span>
                    <span class="p">(</span><span class="nb">= </span><span class="nv">%</span> <span class="mi">13</span><span class="p">))}</span>
       <span class="p">[</span><span class="nv">value</span><span class="p">]</span>
       <span class="p">(</span><span class="nf">continue</span> <span class="nv">value</span><span class="p">))</span>

   <span class="p">(</span><span class="nf">on</span> <span class="ss">:unlucky-number</span> <span class="p">[]</span>
       <span class="p">(</span><span class="nf">continue</span> <span class="s">&quot;-&quot;</span><span class="p">))))</span>

<span class="p">(</span><span class="nf">ints-to-strs-chinese</span> <span class="p">[</span><span class="mi">11</span> <span class="mi">12</span> <span class="mi">13</span> <span class="mi">14</span><span class="p">])</span>
<span class="nv">=&gt;</span> <span class="p">[</span><span class="s">&quot;11&quot;</span> <span class="s">&quot;12&quot;</span> <span class="s">&quot;13&quot;</span> <span class="s">&quot;-&quot;</span><span class="p">]</span>

<span class="p">(</span><span class="nf">ints-to-strs-chinese</span> <span class="p">[</span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">666</span><span class="p">])</span>
<span class="nv">=&gt;</span> <span class="p">[</span><span class="s">&quot;1&quot;</span> <span class="s">&quot;2&quot;</span> <span class="s">&quot;666&quot;</span><span class="p">]</span>
</pre></div>
</div><div><p>The christians don't mind the numbers with 4, don't like 13 and really don't like 666. In this example, it can be seen that if 666 is seen, it will jump out and return straight away, but will continue on processing with other numbers.</p></div><div><div class="highlight"><pre><span class="p">(</span><span class="kd">defn </span><span class="nv">ints-to-strs-christian</span> <span class="p">[</span><span class="nv">arr</span><span class="p">]</span>
  <span class="p">(</span><span class="nf">manage</span>
   <span class="p">(</span><span class="nf">mapv</span> <span class="nv">int-to-str</span> <span class="nv">arr</span><span class="p">)</span>
   <span class="p">(</span><span class="nf">on</span> <span class="p">[</span><span class="ss">:unlucky-number</span><span class="p">]</span> <span class="p">[</span><span class="nv">value</span><span class="p">]</span>
       <span class="p">(</span><span class="nf">condp</span> <span class="nb">= </span><span class="nv">value</span>
         <span class="mi">13</span> <span class="p">(</span><span class="nf">continue</span> <span class="s">&quot;-&quot;</span><span class="p">)</span>
         <span class="mi">666</span> <span class="s">&quot;ARRRGHHH!&quot;</span>
         <span class="p">(</span><span class="nf">continue</span> <span class="nv">value</span><span class="p">)))))</span>

<span class="p">(</span><span class="nf">ints-to-strs-christian</span> <span class="p">[</span><span class="mi">11</span> <span class="mi">12</span> <span class="mi">13</span> <span class="mi">14</span><span class="p">])</span>
<span class="nv">=&gt;</span> <span class="p">[</span><span class="s">&quot;11&quot;</span> <span class="s">&quot;12&quot;</span> <span class="s">&quot;-&quot;</span> <span class="s">&quot;14&quot;</span><span class="p">]</span>

<span class="p">(</span><span class="nf">ints-to-strs-christian</span> <span class="p">[</span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">666</span><span class="p">])</span>
<span class="nv">=&gt;</span> <span class="s">&quot;ARRRGHHH!&quot;</span>
</pre></div>
</div><div><p>It can be seen from this example that the <code>int-to-str</code> function can be reused without any changes. this would be extremely difficult to do with just <code>try/catch</code>.</p><p>For the still sceptical, I'm proposing a <strong>challenge</strong>: to reimplement <code>ints-to-strs-christian</code> without changing <code>unlucky-numbers</code> or <code>int-to-str</code> using only <code>try</code> and <code>catch</code>. I am scared just thinking about it...</p></div><div><a name="conditional-restarts"></a><h2><b>3 &nbsp;&nbsp; Conditional Restarts</b></h2></div><div><p><code>ribol</code> provides a conditional restart system. It can be thought of as an issue resolution system or <code>try++/catch++</code>. We use the term <code>issues</code> to differentiate them from <code>exceptions</code>. The difference is purely semantic: <code>issues</code> are <code>managed</code> whilst <code>exceptions</code> are <code>caught</code>. They all refer to abnormal program flow.</p><p><em>Restart systems</em> are somewhat analogous to a <em>management structure</em>. A low level function will do work until it encounter an abnormal situation. An <code>issue</code> is <code>raised</code> up the chain to higher-level functions. These can <code>manage</code> the situation depending upon the type of <code>issue</code> raised.</p></div><div><p>In the author's experience, there are two forms of <code>exceptions</code> that a programmer will encounter:</p><ol><li><strong>Programming Mistakes</strong> - These are a result of logic and reasoning errors, should not occur in normal operation and should be eliminated as soon as possible. The best strategy for dealing with this is to write unit tests and have functions fail early with a clear message to the programmer what the error is.<ul><li>Null pointers</li><li>Wrong inputs to functions</li></ul></li><li><strong>Exceptions due to Circumstances</strong> - These are circumstancial and should be considered part of the normal operation of the program.<ul><li>A database connection going down</li><li>A file not found</li><li>User input not valid</li></ol></li></ul><p>The common method of <code>try</code> and <code>catch</code> is not really needed when dealing with the <em>Type 1</em> exceptions and a little too weak when dealing with those of <em>Type 2</em>.</p><p>The net effect of using only the <code>try/catch</code> paradigm in application code is that in order to mitigate these <em>Type 2</em> exceptions, there requires a lot of defensive programming. This turns the middle level of the application into spagetti code with program control flow (<code>try/catch</code>) mixed in with program logic.</p><p>Conditional restarts provide a way for the top-level application to more cleanly deal with <em>Type 2</em> exceptions.</p></div><div><a name="raising-issues"></a><h3>3.1 &nbsp;&nbsp; Raising issues</h3></div><div><p><code>ribol</code> provide richer semantics for resolution of <em>Type 2</em> exceptions. Instead of <code>throw</code>, a new form <code>raise</code> is introduced (<a href='#raise-syntax'>e.3.1</a>).</p></div><div><a name="raise-syntax"></a><h4><i>e.3.1  &nbsp;-&nbsp; raise syntax</i></h4><div class="highlight"><pre><span class="p">(</span><span class="nf">raise</span> <span class="p">{</span><span class="ss">:input-not-string</span> <span class="nv">true</span> <span class="ss">:input-data</span> <span class="mi">3</span><span class="p">}</span>     <span class="c1">;; issue payload</span>
       <span class="p">(</span><span class="nf">option</span> <span class="ss">:use-na</span> <span class="p">[]</span> <span class="s">&quot;NA&quot;</span><span class="p">)</span>                   <span class="c1">;; option 1</span>
       <span class="p">(</span><span class="nf">option</span> <span class="ss">:use-custom</span> <span class="p">[</span><span class="nv">n</span><span class="p">]</span> <span class="nv">n</span><span class="p">)</span>                 <span class="c1">;; option 2</span>
       <span class="p">(</span><span class="nf">default</span> <span class="ss">:use-custom</span> <span class="s">&quot;nil&quot;</span><span class="p">))</span>               <span class="c1">;; default choice</span>
</pre></div>
</div><div><p><code>raise</code> differs to <code>throw</code> in a few ways:<ul><li>issues are of type <code>clojure.lang.ExceptionInfo</code>.</li><li>the payload is a <code>hash-map</code>.</li><li><strong>optional</strong>: multiple <code>option</code> handlers can be specified.</li><li><strong>optional</strong>: a <code>default</code> choice can be specified.</li></ul></div><div><a name="managing-issues"></a><h3>3.2 &nbsp;&nbsp; Managing issues</h3></div><div><p>Instead of the <code>try/catch</code> combination, <code>manage/on</code> is used (<a href='#manage-syntax'>e.3.2</a>).</p></div><div><a name="manage-syntax"></a><h4><i>e.3.2  &nbsp;-&nbsp; manage/on syntax</i></h4><div class="highlight"><pre><span class="p">(</span><span class="nf">manage</span> <span class="p">(</span><span class="nf">complex-operation</span><span class="p">)</span>
        <span class="p">(</span><span class="nf">on</span> <span class="ss">:node-working</span> <span class="p">[</span><span class="nv">node-name</span><span class="p">]</span>
            <span class="p">(</span><span class="nf">choose</span> <span class="ss">:wait-for-node</span><span class="p">))</span>
        <span class="p">(</span><span class="nf">on</span> <span class="ss">:node-failed</span> <span class="p">[</span><span class="nv">node-name</span><span class="p">]</span>
            <span class="p">(</span><span class="nf">choose</span> <span class="ss">:reinit-node</span><span class="p">))</span>
        <span class="p">(</span><span class="nf">on</span> <span class="ss">:database-down</span> <span class="p">[]</span>
            <span class="p">(</span><span class="nf">choose</span> <span class="ss">:use-database</span> <span class="nv">backup-database</span><span class="p">))</span>
        <span class="p">(</span><span class="nf">on</span> <span class="ss">:core-failed</span> <span class="p">[]</span>
            <span class="p">(</span><span class="nf">terminate-everything</span><span class="p">)))</span>
</pre></div>
</div><div><p>Issues are managed through <code>on</code> handlers within a <code>manage</code> block. If any <code>issue</code> is raised with the manage block, it is passed to each handler. There are six ways that a handler can deal with a raised issue:<ul><li>directly (same as <code>try/catch</code>)</li><li>using <code>continue</code> to keep going with a given value</li><li>using <code>choose</code> to specify an option</li><li>using <code>escalate</code> to notify higher level managers</li><li>using <code>default</code> to allow the issue to resolve itself</li><li>using <code>fail</code> to throw an exception</li></ul>Using these six different different issue resolution directives, the programmer has the richness of language to craft complex process control flow strategies without mixing logic handling code in the middle tier. Restarts can also create new ways of thinking about the problem beyond the standard <code>throw/catch</code> mechanism and offer more elegant ways to build programs and workflows.</p></div><div><a name="api-reference"></a><h2><b>4 &nbsp;&nbsp; API Reference</b></h2></div><div><a name="api-raise"></a><h3>4.1 &nbsp;&nbsp; raise</h3></div><div><p>The keyword <code>raise</code> is used to raise an 'issue'. At the simplest, when there is no <code>manage</code> blocks, <code>raise</code> just throws a <code>clojure.lang.ExceptionInfo</code> object</p></div><div><div class="highlight"><pre><span class="p">[[{</span><span class="ss">:title</span> <span class="s">&quot;raise is of type clojure.lang.ExceptionInfo&quot;</span> <span class="ss">:tag</span> <span class="s">&quot;raise-type&quot;</span><span class="p">}]]</span>
<span class="p">(</span><span class="nf">raise</span> <span class="p">{</span><span class="ss">:error</span> <span class="nv">true</span><span class="p">})</span>
<span class="nv">=&gt;</span> <span class="p">(</span><span class="nf">throws</span> <span class="nv">clojure.lang.ExceptionInfo</span><span class="p">)</span>
</pre></div>
</div><div><p>The payload of the issue can be extracted using <code>ex-data</code></p></div><div><div class="highlight"><pre><span class="p">(</span><span class="nf">try</span>
  <span class="p">(</span><span class="nf">raise</span> <span class="p">{</span><span class="ss">:error</span> <span class="nv">true</span><span class="p">})</span>
  <span class="p">(</span><span class="nf">catch</span> <span class="nv">clojure.lang.ExceptionInfo</span> <span class="nv">e</span>
    <span class="p">(</span><span class="nf">ex-data</span> <span class="nv">e</span><span class="p">)))</span>
<span class="nv">=&gt;</span> <span class="p">{</span><span class="ss">:error</span> <span class="nv">true</span><span class="p">}</span>
</pre></div>
</div><div><p>The payload can be expressed as a <code>hash-map</code>, a <code>keyword</code> or a <code>vector</code>. We define the <code>raises-issue</code> macro to help explore this a little further:</p></div><div><div class="highlight"><pre><span class="p">(</span><span class="kd">defmacro </span><span class="nv">raises-issue</span> <span class="p">[</span><span class="nv">payload</span><span class="p">]</span>
  <span class="o">`</span><span class="p">(</span><span class="nf">throws</span> <span class="p">(</span><span class="k">fn </span><span class="p">[</span><span class="nv">e#</span><span class="p">]</span> 
             <span class="p">((</span><span class="nf">just</span> <span class="o">~</span><span class="nv">payload</span><span class="p">)</span> <span class="p">(</span><span class="nf">ex-data</span> <span class="nv">e#</span><span class="p">)))))</span>
</pre></div>
</div><div><p>Please note that the <code>raises-issue</code> macro is only working with <code>midje</code>. In order to work outside of midje, we need to define the <code>payload</code> macro:</p></div><div><div class="highlight"><pre><span class="p">(</span><span class="kd">defmacro </span><span class="nv">payload</span> <span class="p">[</span><span class="o">&amp;</span> <span class="nv">body</span><span class="p">]</span>
    <span class="o">`</span><span class="p">(</span><span class="nf">try</span> <span class="o">~@</span><span class="nv">body</span>
          <span class="p">(</span><span class="nf">throw</span> <span class="p">(</span><span class="nf">Throwable.</span><span class="p">))</span>
          <span class="p">(</span><span class="nf">catch</span> <span class="nv">clojure.lang.ExceptionInfo</span> <span class="nv">e#</span>
            <span class="p">(</span><span class="nf">ex-data</span> <span class="nv">e#</span><span class="p">))</span>
          <span class="p">(</span><span class="nf">catch</span> <span class="nv">Throwable</span> <span class="nv">t#</span>
            <span class="p">(</span><span class="nf">throw</span> <span class="p">(</span><span class="nf">Exception.</span> <span class="s">&quot;No Issue raised&quot;</span><span class="p">)))))</span>
</pre></div>
</div><div><p>Its can be used to detect what type of issue has been raised:</p></div><div><div class="highlight"><pre><span class="p">(</span><span class="nf">payload</span> <span class="p">(</span><span class="nf">raise</span> <span class="ss">:error</span><span class="p">))</span>
<span class="nv">=&gt;</span> <span class="p">{</span><span class="ss">:error</span> <span class="nv">true</span><span class="p">}</span>
</pre></div>
</div><div><a name="hash-map"></a><h3><i>4.1.1 &nbsp;&nbsp; hash-map</i></h3></div><div><p>Because the issue can be expressed as a hash-map, it is more general than using a class to represent exceptions.</p></div><div><div class="highlight"><pre><span class="p">(</span><span class="nf">raise</span> <span class="p">{</span><span class="ss">:error</span> <span class="nv">true</span> <span class="ss">:data</span> <span class="s">&quot;data&quot;</span><span class="p">})</span>
<span class="nv">=&gt;</span> <span class="p">(</span><span class="nf">raises-issue</span> <span class="p">{</span><span class="ss">:error</span> <span class="nv">true</span> <span class="ss">:data</span> <span class="s">&quot;data&quot;</span><span class="p">})</span>
</pre></div>
</div><div><a name="keyword"></a><h3><i>4.1.2 &nbsp;&nbsp; keyword</i></h3></div><div><p>When a <code>keyword</code> is used, it is shorthand for a map with having the specified keyword with value <code>true</code>.</p></div><div><div class="highlight"><pre><span class="p">(</span><span class="nf">raise</span> <span class="ss">:error</span><span class="p">)</span>
<span class="nv">=&gt;</span> <span class="p">(</span><span class="nf">raises-issue</span> <span class="p">{</span><span class="ss">:error</span> <span class="nv">true</span><span class="p">})</span>
</pre></div>
</div><div><a name="vector"></a><h3><i>4.1.3 &nbsp;&nbsp; vector</i></h3></div><div><p>Vectors can contain only keywords or both maps and keywords. They are there mainly for syntacic sugar</p></div><div><div class="highlight"><pre><span class="p">(</span><span class="nf">raise</span> <span class="p">[</span><span class="ss">:lvl-1</span> <span class="ss">:lvl-2</span> <span class="ss">:lvl-3</span><span class="p">])</span>
<span class="nv">=&gt;</span> <span class="p">(</span><span class="nf">raises-issue</span> <span class="p">{</span><span class="ss">:lvl-1</span> <span class="nv">true</span> <span class="ss">:lvl-2</span> <span class="nv">true</span> <span class="ss">:lvl-3</span> <span class="nv">true</span><span class="p">})</span>


<span class="p">(</span><span class="nf">raise</span> <span class="p">[</span><span class="ss">:lvl-1</span> <span class="p">{</span><span class="ss">:lvl-2</span> <span class="nv">true</span> <span class="ss">:data</span> <span class="s">&quot;data&quot;</span><span class="p">}])</span>
 <span class="nv">=&gt;</span> <span class="p">(</span><span class="nf">raises-issue</span> <span class="p">{</span><span class="ss">:lvl-1</span> <span class="nv">true</span> <span class="ss">:lvl-2</span> <span class="nv">true</span> <span class="ss">:data</span> <span class="s">&quot;data&quot;</span><span class="p">})</span>
</pre></div>
</div><div><a name="option/default"></a><h3><i>4.1.4 &nbsp;&nbsp; option/default</i></h3></div><div><p>Strategies for an unmanaged issue can be specified within the raise form:<ul><li><a href='#option-one'>e.4.1</a> specifies two options and the specifies the default option as <code>:use-nil</code>.</li><li><a href='#option-two'>e.4.2</a> sets the default as <code>:use-custom</code> with an argument of <code>10</code>.</li><li><a href='#option-none'>e.4.3</a> shows that if there is no default selection, then an exception will be thrown as per previously seen:</li></ul></div><div><a name="option-one"></a><h4><i>e.4.1  &nbsp;-&nbsp; default :use-nil</i></h4><div class="highlight"><pre><span class="p">(</span><span class="nf">raise</span> <span class="ss">:error</span>
       <span class="p">(</span><span class="nf">option</span> <span class="ss">:use-nil</span> <span class="p">[]</span> <span class="nv">nil</span><span class="p">)</span>
       <span class="p">(</span><span class="nf">option</span> <span class="ss">:use-custom</span> <span class="p">[</span><span class="nv">n</span><span class="p">]</span> <span class="nv">n</span><span class="p">)</span>
       <span class="p">(</span><span class="nf">default</span> <span class="ss">:use-nil</span><span class="p">))</span>

<span class="nv">=&gt;</span> <span class="nv">nil</span>
</pre></div>
</div><div><a name="option-two"></a><h4><i>e.4.2  &nbsp;-&nbsp; default :use-custom</i></h4><div class="highlight"><pre><span class="p">(</span><span class="nf">raise</span> <span class="ss">:error</span>
       <span class="p">(</span><span class="nf">option</span> <span class="ss">:use-nil</span> <span class="p">[]</span> <span class="nv">nil</span><span class="p">)</span>
       <span class="p">(</span><span class="nf">option</span> <span class="ss">:use-custom</span> <span class="p">[</span><span class="nv">n</span><span class="p">]</span> <span class="nv">n</span><span class="p">)</span>
       <span class="p">(</span><span class="nf">default</span> <span class="ss">:use-custom</span> <span class="mi">10</span><span class="p">))</span>

<span class="nv">=&gt;</span> <span class="mi">10</span>
</pre></div>
</div><div><a name="option-none"></a><h4><i>e.4.3  &nbsp;-&nbsp; no default</i></h4><div class="highlight"><pre><span class="p">(</span><span class="nf">raise</span> <span class="ss">:error</span>
       <span class="p">(</span><span class="nf">option</span> <span class="ss">:use-nil</span> <span class="p">[]</span> <span class="nv">nil</span><span class="p">)</span>
       <span class="p">(</span><span class="nf">option</span> <span class="ss">:use-custom</span> <span class="p">[</span><span class="nv">n</span><span class="p">]</span> <span class="nv">n</span><span class="p">))</span>

<span class="nv">=&gt;</span> <span class="p">(</span><span class="nf">raises-issue</span> <span class="p">{</span><span class="ss">:error</span> <span class="nv">true</span><span class="p">})</span>
</pre></div>
</div><div><a name="manage/on"></a><h3>4.2 &nbsp;&nbsp; manage/on</h3></div><div><p>Raised issues can be resolved through use of <code>manage</code> blocks set up. The blocks set up execution scope, providing handlers and options to redirect program flow. A manage block looks like this:</p></div><div><div class="highlight"><pre><span class="p">(</span><span class="nf">manage</span>

 <span class="nv">...</span> <span class="nv">code</span> <span class="nv">that</span> <span class="nv">may</span> <span class="nv">raise</span> <span class="nv">issue</span> <span class="nv">...</span>

 <span class="p">(</span><span class="nf">on</span> <span class="nv">&lt;chk&gt;</span> <span class="nv">&lt;bindings&gt;</span>
     <span class="nv">...</span> <span class="nv">handler</span> <span class="nv">body</span> <span class="nv">...</span><span class="p">)</span>

 <span class="p">(</span><span class="nf">option</span> <span class="nv">&lt;label&gt;</span> <span class="nv">&lt;bindings&gt;</span>
     <span class="nv">...</span> <span class="nv">option</span> <span class="nv">body</span> <span class="nv">...</span><span class="p">)</span>

 <span class="p">(</span><span class="nf">finally</span>                   <span class="c1">;; only one</span>
     <span class="nv">...</span> <span class="nv">finally</span> <span class="nv">body</span> <span class="nv">...</span><span class="p">))</span>
</pre></div>
</div><div><p>We define <code>half-int</code> and its usage:</p></div><div><div class="highlight"><pre><span class="p">(</span><span class="kd">defn </span><span class="nv">half-int</span> <span class="p">[</span><span class="nv">n</span><span class="p">]</span>
  <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">= </span><span class="mi">0</span> <span class="p">(</span><span class="nf">mod</span> <span class="nv">n</span> <span class="mi">2</span><span class="p">))</span>
    <span class="p">(</span><span class="nb">quot </span><span class="nv">n</span> <span class="mi">2</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">raise</span> <span class="p">[</span><span class="ss">:odd-number</span> <span class="p">{</span><span class="ss">:value</span> <span class="nv">n</span><span class="p">}])))</span>
</pre></div>
</div><div><div class="highlight"><pre><span class="p">(</span><span class="nf">half-int</span> <span class="mi">2</span><span class="p">)</span>
<span class="nv">=&gt;</span> <span class="mi">1</span>

<span class="p">(</span><span class="nf">half-int</span> <span class="mi">3</span><span class="p">)</span>
<span class="nv">=&gt;</span> <span class="p">(</span><span class="nf">raises-issue</span> <span class="p">{</span><span class="ss">:odd-number</span> <span class="nv">true</span> <span class="ss">:value</span> <span class="mi">3</span><span class="p">})</span>
</pre></div>
</div><div><a name="checkers"></a><h3><i>4.2.1 &nbsp;&nbsp; checkers</i></h3></div><div><p>Within the <code>manage</code> form, issue handlers are specified with <code>on</code>. The form requires a check, which if returns true will be  <br /></p></div><div><div class="highlight"><pre><span class="p">(</span><span class="nf">manage</span>
 <span class="p">(</span><span class="nf">mapv</span> <span class="nv">half-int</span> <span class="p">[</span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span><span class="p">])</span>
 <span class="p">(</span><span class="nf">on</span> <span class="ss">:odd-number</span> <span class="p">[]</span>
     <span class="s">&quot;odd-number-exception&quot;</span><span class="p">))</span>
<span class="nv">=&gt;</span> <span class="s">&quot;odd-number-exception&quot;</span>
</pre></div>
</div><div><p>The checker can be a map with the value</p></div><div><div class="highlight"><pre><span class="p">(</span><span class="nf">manage</span>
 <span class="p">(</span><span class="nf">mapv</span> <span class="nv">half-int</span> <span class="p">[</span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span><span class="p">])</span>
 <span class="p">(</span><span class="nf">on</span> <span class="p">{</span><span class="ss">:odd-number</span> <span class="nv">true</span><span class="p">}</span> <span class="p">[]</span>
     <span class="s">&quot;odd-number-exception&quot;</span><span class="p">))</span>
<span class="nv">=&gt;</span> <span class="s">&quot;odd-number-exception&quot;</span>
</pre></div>
</div><div><p>Or it can be a map with a checking function:</p></div><div><div class="highlight"><pre><span class="p">(</span><span class="nf">manage</span>
 <span class="p">(</span><span class="nf">mapv</span> <span class="nv">half-int</span> <span class="p">[</span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span><span class="p">])</span>
 <span class="p">(</span><span class="nf">on</span> <span class="p">{</span><span class="ss">:odd-number</span> <span class="nv">true?</span><span class="p">}</span> <span class="p">[]</span>
     <span class="s">&quot;odd-number-exception&quot;</span><span class="p">))</span>
<span class="nv">=&gt;</span> <span class="s">&quot;odd-number-exception&quot;</span>
</pre></div>
</div><div><p>A set will check if any elements are true</p></div><div><div class="highlight"><pre><span class="p">(</span><span class="nf">manage</span>
 <span class="p">(</span><span class="nf">mapv</span> <span class="nv">half-int</span> <span class="p">[</span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span><span class="p">])</span>
 <span class="p">(</span><span class="nf">on</span> <span class="o">#</span><span class="p">{</span><span class="ss">:odd-number</span><span class="p">}</span> <span class="p">[]</span>
     <span class="s">&quot;odd-number-exception&quot;</span><span class="p">))</span>
<span class="nv">=&gt;</span> <span class="s">&quot;odd-number-exception&quot;</span>
</pre></div>
</div><div><p>A vector will check if all elements are true </p></div><div><div class="highlight"><pre><span class="p">(</span><span class="nf">manage</span>
 <span class="p">(</span><span class="nf">mapv</span> <span class="nv">half-int</span> <span class="p">[</span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span><span class="p">])</span>
 <span class="p">(</span><span class="nf">on</span> <span class="p">[</span><span class="ss">:odd-number</span><span class="p">]</span> <span class="p">[]</span>
     <span class="s">&quot;odd-number-exception&quot;</span><span class="p">))</span>
<span class="nv">=&gt;</span> <span class="s">&quot;odd-number-exception&quot;</span>
</pre></div>
</div><div><p>An underscore will match anything</p></div><div><div class="highlight"><pre><span class="p">(</span><span class="nf">manage</span>
 <span class="p">(</span><span class="nf">mapv</span> <span class="nv">half-int</span> <span class="p">[</span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span><span class="p">])</span>
 <span class="p">(</span><span class="nf">on</span> <span class="nv">_</span> <span class="p">[]</span>
     <span class="s">&quot;odd-number-exception&quot;</span><span class="p">))</span>
<span class="nv">=&gt;</span> <span class="s">&quot;odd-number-exception&quot;</span>
</pre></div>
</div><div><p><code>on-any</code> can also be used instead of <code>on &#95;</code></p></div><div><div class="highlight"><pre><span class="p">(</span><span class="nf">manage</span>
 <span class="p">(</span><span class="nf">mapv</span> <span class="nv">half-int</span> <span class="p">[</span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span><span class="p">])</span>
 <span class="p">(</span><span class="nf">on-any</span> <span class="p">[]</span>
     <span class="s">&quot;odd-number-exception&quot;</span><span class="p">))</span>
<span class="nv">=&gt;</span> <span class="s">&quot;odd-number-exception&quot;</span>
</pre></div>
</div><div><a name="bindings"></a><h3><i>4.2.2 &nbsp;&nbsp; bindings</i></h3></div><div><p>Bindings within the <code>on</code> handler allow values in the issue payload to be accessed:</p></div><div><div class="highlight"><pre><span class="p">(</span><span class="nf">manage</span>
 <span class="p">(</span><span class="nf">mapv</span> <span class="nv">half-int</span> <span class="p">[</span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span><span class="p">])</span>
 <span class="p">(</span><span class="nf">on</span> <span class="ss">:odd-number</span> <span class="nv">e</span>
     <span class="p">(</span><span class="nb">str </span><span class="s">&quot;odd-number: &quot;</span> <span class="p">(</span><span class="ss">:odd-number</span> <span class="nv">e</span><span class="p">)</span> <span class="s">&quot;, value: &quot;</span> <span class="p">(</span><span class="ss">:value</span> <span class="nv">e</span><span class="p">))))</span>
<span class="nv">=&gt;</span> <span class="s">&quot;odd-number: true, value: 1&quot;</span>
</pre></div>
</div><div><p>Bindings can be a vector</p></div><div><div class="highlight"><pre><span class="p">(</span><span class="nf">manage</span>
 <span class="p">(</span><span class="nf">mapv</span> <span class="nv">half-int</span> <span class="p">[</span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span><span class="p">])</span>
 <span class="p">(</span><span class="nf">on</span> <span class="ss">:odd-number</span> <span class="p">[</span><span class="nv">odd-number</span> <span class="nv">value</span><span class="p">]</span>
     <span class="p">(</span><span class="nb">str </span><span class="s">&quot;odd-number: &quot;</span> <span class="nv">odd-number</span> <span class="s">&quot;, value: &quot;</span> <span class="nv">value</span><span class="p">)))</span>
<span class="nv">=&gt;</span> <span class="s">&quot;odd-number: true, value: 1&quot;</span>
</pre></div>
</div><div><p>Bindings can also be a hashmap</p></div><div><div class="highlight"><pre><span class="p">(</span><span class="nf">manage</span>
 <span class="p">(</span><span class="nf">mapv</span> <span class="nv">half-int</span> <span class="p">[</span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span><span class="p">])</span>
 <span class="p">(</span><span class="nf">on</span> <span class="ss">:odd-number</span> <span class="p">{</span><span class="nv">odd?</span> <span class="ss">:odd-number</span> <span class="nv">v</span> <span class="ss">:value</span><span class="p">}</span>
     <span class="p">(</span><span class="nb">str </span><span class="s">&quot;odd-number: &quot;</span> <span class="nv">odd?</span> <span class="s">&quot;, value: &quot;</span> <span class="nv">v</span><span class="p">)))</span>
<span class="nv">=&gt;</span> <span class="s">&quot;odd-number: true, value: 1&quot;</span>
</pre></div>
</div><div><a name="catch-and-finally"></a><h3><i>4.2.3 &nbsp;&nbsp; catch and finally</i></h3></div><div><p>The special forms <code>catch</code> and <code>finally</code> are also supported in the <code>manage</code> blocks for exception handling just as they are in <code>try</code> blocks.</p></div><div><div class="highlight"><pre><span class="p">(</span><span class="nf">manage</span>
 <span class="p">(</span><span class="nf">throw</span> <span class="p">(</span><span class="nf">Exception.</span> <span class="s">&quot;Hello&quot;</span><span class="p">))</span>
 <span class="p">(</span><span class="nf">catch</span> <span class="nv">Exception</span> <span class="nv">e</span>
   <span class="s">&quot;odd-number-exception&quot;</span><span class="p">)</span>
 <span class="p">(</span><span class="nf">finally</span>
   <span class="p">(</span><span class="nb">println </span><span class="s">&quot;Hello&quot;</span><span class="p">)))</span>
<span class="nv">=&gt;</span> <span class="s">&quot;odd-number-exception&quot;</span> <span class="c1">;; Also prints &quot;Hello&quot;</span>
</pre></div>
</div><div><p>They can be mixed and matched with <code>on</code> forms</p></div><div><div class="highlight"><pre><span class="p">(</span><span class="nf">manage</span>
 <span class="p">(</span><span class="nf">mapv</span> <span class="nv">half-int</span> <span class="p">[</span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span><span class="p">])</span>
 <span class="p">(</span><span class="nf">on</span> <span class="ss">:odd-number</span> <span class="p">[]</span>
     <span class="s">&quot;odd-number-exception&quot;</span><span class="p">)</span>
 <span class="p">(</span><span class="nf">finally</span>
   <span class="p">(</span><span class="nb">println </span><span class="s">&quot;Hello&quot;</span><span class="p">)))</span>
<span class="nv">=&gt;</span> <span class="s">&quot;odd-number-exception&quot;</span> <span class="c1">;; Also prints &quot;Hello&quot;</span>
</pre></div>
</div><div><a name="special-forms"></a><h3>4.3 &nbsp;&nbsp; special forms</h3></div><div><p>There are five special forms that can be used within the <code>on</code> handler:<ul><li>continue</li><li>fail</li><li>choose</li><li>default</li><li>escalate</li></ul></div><div><a name="api-continue"></a><h3><i>4.3.1 &nbsp;&nbsp; continue</i></h3></div><div><p>The <code>continue</code> special form is used to continue the operation from the point that the <code>issue</code> was raised (<a href='#continue-using-nan'>e.4.4</a>). It must be pointed out that this is impossible to do using the <code>try/catch</code> paradigm because the all the information from the stack will be lost.</p><p>  The <code>on</code> handler can take keys of the <code>payload</code> of the raised <code>issue</code> as parameters. In <a href='#continue-using-str'>e.4.5</a>, a vector containing strings of the odd numbers are formed. Whereas in <a href='#continue-using-fractions'>e.4.6</a>, the on handler puts in fractions instead.</p></div><div><a name="continue-using-nan"></a><h4><i>e.4.4  &nbsp;-&nbsp; continue using nan</i></h4><div class="highlight"><pre><span class="p">(</span><span class="nf">manage</span>
 <span class="p">(</span><span class="nf">mapv</span> <span class="nv">half-int</span> <span class="p">[</span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span><span class="p">])</span>
 <span class="p">(</span><span class="nf">on</span> <span class="ss">:odd-number</span> <span class="p">[]</span>
     <span class="p">(</span><span class="nf">continue</span> <span class="ss">:nan</span><span class="p">)))</span>

<span class="nv">=&gt;</span> <span class="p">[</span><span class="ss">:nan</span> <span class="mi">1</span> <span class="ss">:nan</span> <span class="mi">2</span><span class="p">]</span>
</pre></div>
</div><div><a name="continue-using-str"></a><h4><i>e.4.5  &nbsp;-&nbsp; continue using str</i></h4><div class="highlight"><pre><span class="p">(</span><span class="nf">manage</span>
 <span class="p">(</span><span class="nf">mapv</span> <span class="nv">half-int</span> <span class="p">[</span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span><span class="p">])</span>
 <span class="p">(</span><span class="nf">on</span> <span class="ss">:odd-number</span> <span class="p">[</span><span class="nv">value</span><span class="p">]</span>
     <span class="p">(</span><span class="nf">continue</span> <span class="p">(</span><span class="nb">str </span><span class="nv">value</span><span class="p">))))</span>

<span class="nv">=&gt;</span> <span class="p">[</span><span class="s">&quot;1&quot;</span> <span class="mi">1</span> <span class="s">&quot;3&quot;</span> <span class="mi">2</span><span class="p">]</span>
</pre></div>
</div><div><a name="continue-using-fractions"></a><h4><i>e.4.6  &nbsp;-&nbsp; continue using fractions</i></h4><div class="highlight"><pre><span class="p">(</span><span class="nf">manage</span>
 <span class="p">(</span><span class="nf">mapv</span> <span class="nv">half-int</span> <span class="p">[</span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span><span class="p">])</span>
 <span class="p">(</span><span class="nf">on</span> <span class="ss">:odd-number</span> <span class="p">[</span><span class="nv">value</span><span class="p">]</span>
     <span class="p">(</span><span class="nf">continue</span> <span class="p">(</span><span class="nb">/ </span><span class="nv">value</span> <span class="mi">2</span><span class="p">))))</span>

<span class="nv">=&gt;</span> <span class="p">[</span><span class="mi">1</span><span class="nv">/2</span> <span class="mi">1</span> <span class="mi">3</span><span class="nv">/2</span> <span class="mi">2</span><span class="p">]</span>
</pre></div>
</div><div><a name="api-fail"></a><h3><i>4.3.2 &nbsp;&nbsp; fail</i></h3></div><div><p>The <code>fail</code> special form will forcibly cause an exception to be thrown. It is used when there is no need to advise managers of situation. More data can be added to the failure (<a href='#fail-example'>e.</a>).</p></div><div><a name="failure"></a><h4><i>e.4.7  &nbsp;-&nbsp; failure</i></h4><div class="highlight"><pre><span class="p">(</span><span class="nf">manage</span>
  <span class="p">(</span><span class="nf">mapv</span> <span class="nv">half-int</span> <span class="p">[</span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span><span class="p">])</span>
  <span class="p">(</span><span class="nf">on</span> <span class="ss">:odd-number</span> <span class="p">[]</span>
    <span class="p">(</span><span class="nf">fail</span> <span class="p">[</span><span class="ss">:unhandled</span> <span class="ss">:error</span><span class="p">])))</span>

<span class="nv">=&gt;</span> <span class="p">(</span><span class="nf">raises-issue</span> <span class="p">{</span><span class="ss">:value</span> <span class="mi">1</span> <span class="ss">:odd-number</span> <span class="nv">true</span> <span class="ss">:unhandled</span> <span class="nv">true</span> <span class="ss">:error</span> <span class="nv">true</span><span class="p">})</span>
</pre></div>
</div><div><a name="api-choose"></a><h3><i>4.3.3 &nbsp;&nbsp; choose</i></h3></div><div><p>The <code>choose</code> special form is used to jump to a <code>option</code>. A new function <code>half-int-b</code> (<a href='#half-int-b-definition'>e.</a>) is defined giving options to jump to within the <code>raise</code> form.</p></div><div><div class="highlight"><pre><span class="p">(</span><span class="kd">defn </span><span class="nv">half-int-b</span> <span class="p">[</span><span class="nv">n</span><span class="p">]</span>
    <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">= </span><span class="mi">0</span> <span class="p">(</span><span class="nf">mod</span> <span class="nv">n</span> <span class="mi">2</span><span class="p">))</span>
      <span class="p">(</span><span class="nb">quot </span><span class="nv">n</span> <span class="mi">2</span><span class="p">)</span>
      <span class="p">(</span><span class="nf">raise</span> <span class="p">[</span><span class="ss">:odd-number</span> <span class="p">{</span><span class="ss">:value</span> <span class="nv">n</span><span class="p">}]</span>
             <span class="p">(</span><span class="nf">option</span> <span class="ss">:use-nil</span> <span class="p">[]</span> <span class="nv">nil</span><span class="p">)</span>
             <span class="p">(</span><span class="nf">option</span> <span class="ss">:use-nan</span> <span class="p">[]</span> <span class="ss">:nan</span><span class="p">)</span>
             <span class="p">(</span><span class="nf">option</span> <span class="ss">:use-custom</span> <span class="p">[</span><span class="nv">n</span><span class="p">]</span> <span class="nv">n</span><span class="p">))))</span>
</pre></div>
</div><div><p>Its usage can be seen in <a href='#choose-ex-1'>e.4.8</a> where different paths can be chosen depending upon <code>:value</code>. An option can also be specified in the manage block (<a href='#choose-ex-2'>e.4.9</a>). Options can also be overridden when specified in higher manage blocks (<a href='#choose-ex-3'>e.4.10</a>). </p></div><div><a name="choose-ex-1"></a><h4><i>e.4.8  &nbsp;-&nbsp; choosing different paths based on value</i></h4><div class="highlight"><pre><span class="p">(</span><span class="nf">manage</span>
 <span class="p">(</span><span class="nf">mapv</span> <span class="nv">half-int-b</span> <span class="p">[</span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span><span class="p">])</span>
 <span class="p">(</span><span class="nf">on</span> <span class="p">{</span><span class="ss">:value</span> <span class="mi">1</span><span class="p">}</span> <span class="p">[]</span>
     <span class="p">(</span><span class="nf">choose</span> <span class="ss">:use-nil</span><span class="p">))</span>
 <span class="p">(</span><span class="nf">on</span> <span class="p">{</span><span class="ss">:value</span> <span class="mi">3</span><span class="p">}</span> <span class="p">[</span><span class="nv">value</span><span class="p">]</span>
     <span class="p">(</span><span class="nf">choose</span> <span class="ss">:use-custom</span> <span class="p">(</span><span class="nb">/ </span><span class="nv">value</span> <span class="mi">2</span><span class="p">))))</span>

<span class="nv">=&gt;</span> <span class="p">[</span><span class="nv">nil</span> <span class="mi">1</span> <span class="mi">3</span><span class="nv">/2</span> <span class="mi">2</span><span class="p">]</span>
</pre></div>
</div><div><a name="choose-ex-2"></a><h4><i>e.4.9  &nbsp;-&nbsp; choosing option within manage form</i></h4><div class="highlight"><pre><span class="p">(</span><span class="nf">manage</span>
 <span class="p">(</span><span class="nf">mapv</span> <span class="nv">half-int-b</span> <span class="p">[</span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span><span class="p">])</span>
 <span class="p">(</span><span class="nf">on</span> <span class="ss">:odd-number</span> <span class="p">[]</span>
     <span class="p">(</span><span class="nf">choose</span> <span class="ss">:use-empty</span><span class="p">))</span>
 <span class="p">(</span><span class="nf">option</span> <span class="ss">:use-empty</span> <span class="p">[]</span> <span class="p">[]))</span>

<span class="nv">=&gt;</span> <span class="p">[]</span>
</pre></div>
</div><div><a name="choose-ex-3"></a><h4><i>e.4.10  &nbsp;-&nbsp; overwriting :use-nil within manage form</i></h4><div class="highlight"><pre><span class="p">(</span><span class="nf">manage</span>
 <span class="p">(</span><span class="nf">mapv</span> <span class="nv">half-int-b</span> <span class="p">[</span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span><span class="p">])</span>
 <span class="p">(</span><span class="nf">on</span> <span class="ss">:odd-number</span> <span class="p">[]</span>
     <span class="p">(</span><span class="nf">choose</span> <span class="ss">:use-nil</span><span class="p">))</span>
 <span class="p">(</span><span class="nf">option</span> <span class="ss">:use-nil</span> <span class="p">[]</span> <span class="nv">nil</span><span class="p">))</span>

<span class="nv">=&gt;</span> <span class="nv">nil</span>
</pre></div>
</div><div><a name="api-default"></a><h3><i>4.3.4 &nbsp;&nbsp; default</i></h3></div><div><p> The <code>default</code> special short-circuits the raise process and skips managers further up to use an issue's default option. A function is defined and is usage is shown how the <code>default</code> form behaves. </p></div><div><div class="highlight"><pre><span class="p">(</span><span class="kd">defn </span><span class="nv">half-int-c</span> <span class="p">[</span><span class="nv">n</span><span class="p">]</span>
  <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">= </span><span class="mi">0</span> <span class="p">(</span><span class="nf">mod</span> <span class="nv">n</span> <span class="mi">2</span><span class="p">))</span>
    <span class="p">(</span><span class="nb">quot </span><span class="nv">n</span> <span class="mi">2</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">raise</span> <span class="p">[</span><span class="ss">:odd-number</span> <span class="p">{</span><span class="ss">:value</span> <span class="nv">n</span><span class="p">}]</span>
           <span class="p">(</span><span class="nf">option</span> <span class="ss">:use-nil</span> <span class="p">[]</span> <span class="nv">nil</span><span class="p">)</span>
           <span class="p">(</span><span class="nf">option</span> <span class="ss">:use-custom</span> <span class="p">[</span><span class="nv">n</span><span class="p">]</span> <span class="nv">n</span><span class="p">)</span>
           <span class="p">(</span><span class="nf">default</span> <span class="ss">:use-custom</span> <span class="ss">:odd</span><span class="p">))))</span>

<span class="p">(</span><span class="nf">manage</span>
 <span class="p">(</span><span class="nf">mapv</span> <span class="nv">half-int-c</span> <span class="p">[</span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span><span class="p">])</span>
 <span class="p">(</span><span class="nf">on</span> <span class="ss">:odd-number</span> <span class="p">[</span><span class="nv">value</span><span class="p">]</span> <span class="p">(</span><span class="nf">default</span><span class="p">)))</span>
<span class="nv">=&gt;</span> <span class="p">[</span><span class="ss">:odd</span> <span class="mi">1</span> <span class="ss">:odd</span> <span class="mi">2</span><span class="p">]</span>
</pre></div>
</div><div><p>The <code>default</code> form can even refer to an option that has to be implemented higher up in scope. An additional function is defined: </p></div><div><div class="highlight"><pre><span class="p">(</span><span class="kd">defn </span><span class="nv">half-int-d</span> <span class="p">[</span><span class="nv">n</span><span class="p">]</span>
  <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">= </span><span class="mi">0</span> <span class="p">(</span><span class="nf">mod</span> <span class="nv">n</span> <span class="mi">2</span><span class="p">))</span>
    <span class="p">(</span><span class="nb">quot </span><span class="nv">n</span> <span class="mi">2</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">raise</span> <span class="p">[</span><span class="ss">:odd-number</span> <span class="p">{</span><span class="ss">:value</span> <span class="nv">n</span><span class="p">}]</span>
           <span class="p">(</span><span class="nf">default</span> <span class="ss">:use-empty</span><span class="p">))))</span>
</pre></div>
</div><div><p>The usage for <code>half-int-d</code> can be seen in (<a href='#d-alone'>e.4.11</a> and <a href='#d-higher'>e.4.12</a>) to show these particular cases.</p></div><div><a name="d-alone"></a><h4><i>e.4.11  &nbsp;-&nbsp; half-int-d alone</i></h4><div class="highlight"><pre><span class="p">(</span><span class="nf">half-int-d</span> <span class="mi">3</span><span class="p">)</span>

<span class="nv">=&gt;</span> <span class="p">(</span><span class="nf">throws</span> <span class="nv">java.lang.Exception</span> <span class="s">&quot;RAISE_CHOOSE: the label :use-empty has not been implemented&quot;</span><span class="p">)</span>
</pre></div>
</div><div><a name="d-higher"></a><h4><i>e.4.12  &nbsp;-&nbsp; half-int-d inside manage block</i></h4><div class="highlight"><pre><span class="p">(</span><span class="nf">manage</span>
 <span class="p">(</span><span class="nf">mapv</span> <span class="nv">half-int-d</span> <span class="p">[</span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span><span class="p">])</span>
 <span class="p">(</span><span class="nf">option</span> <span class="ss">:use-empty</span> <span class="p">[]</span> <span class="p">[])</span>
 <span class="p">(</span><span class="nf">on</span> <span class="ss">:odd-number</span> <span class="p">[]</span>
     <span class="p">(</span><span class="nf">default</span><span class="p">)))</span>

<span class="nv">=&gt;</span> <span class="p">[]</span>
</pre></div>
</div><div><a name="api-escalate"></a><h3><i>4.3.5 &nbsp;&nbsp; escalate</i></h3></div><div><p>The <code>escalate</code> special form is used to add additional information to the issue and raised to higher managers. In the following example, if a <code>3</code> or a <code>5</code> is seen, then the flag <code>:three-or-five</code> is added to the issue and the <code>:odd-number</code> flag is set false.</p></div><div><div class="highlight"><pre><span class="p">(</span><span class="kd">defn </span><span class="nv">half-array-e</span> <span class="p">[</span><span class="nv">arr</span><span class="p">]</span>
  <span class="p">(</span><span class="nf">manage</span>
    <span class="p">(</span><span class="nf">mapv</span> <span class="nv">half-int-d</span> <span class="nv">arr</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">on</span> <span class="p">{</span><span class="ss">:value</span> <span class="p">(</span><span class="k">fn </span><span class="p">[</span><span class="nv">v</span><span class="p">]</span> <span class="p">(</span><span class="o">#</span><span class="p">{</span><span class="mi">3</span> <span class="mi">5</span><span class="p">}</span> <span class="nv">v</span><span class="p">))}</span> <span class="p">[</span><span class="nv">value</span><span class="p">]</span>
        <span class="p">(</span><span class="nf">escalate</span> <span class="p">[</span><span class="ss">:three-or-five</span> <span class="p">{</span><span class="ss">:odd-number</span> <span class="nv">false</span><span class="p">}]))))</span>

<span class="p">(</span><span class="nf">manage</span>
  <span class="p">(</span><span class="nf">half-array-e</span> <span class="p">[</span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span><span class="p">])</span>
  <span class="p">(</span><span class="nf">on</span> <span class="ss">:odd-number</span> <span class="p">[</span><span class="nv">value</span><span class="p">]</span>
      <span class="p">(</span><span class="nf">continue</span> <span class="p">(</span><span class="nb">* </span><span class="nv">value</span> <span class="mi">10</span><span class="p">)))</span>
  <span class="p">(</span><span class="nf">on</span> <span class="ss">:three-or-five</span> <span class="p">[</span><span class="nv">value</span><span class="p">]</span>
      <span class="p">(</span><span class="nf">continue</span> <span class="p">(</span><span class="nb">* </span><span class="nv">value</span> <span class="mi">100</span><span class="p">))))</span>
  <span class="nv">=&gt;</span> <span class="p">[</span><span class="mi">10</span> <span class="mi">1</span> <span class="mi">300</span> <span class="mi">2</span> <span class="mi">500</span><span class="p">]</span>
</pre></div>
</div><div><p>Program decision points can be changed by higher level managers through <code>escalate</code></p></div><div><div class="highlight"><pre><span class="p">(</span><span class="kd">defn </span><span class="nv">half-int-f</span> <span class="p">[</span><span class="nv">n</span><span class="p">]</span>
 <span class="p">(</span><span class="nf">manage</span>
   <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">= </span><span class="mi">0</span> <span class="p">(</span><span class="nf">mod</span> <span class="nv">n</span> <span class="mi">2</span><span class="p">))</span>
     <span class="p">(</span><span class="nb">quot </span><span class="nv">n</span> <span class="mi">2</span><span class="p">)</span>
     <span class="p">(</span><span class="nf">raise</span> <span class="p">[</span><span class="ss">:odd-number</span> <span class="p">{</span><span class="ss">:value</span> <span class="nv">n</span><span class="p">}]</span>
       <span class="p">(</span><span class="nf">option</span> <span class="ss">:use-nil</span> <span class="p">[]</span> <span class="nv">nil</span><span class="p">)</span>
       <span class="p">(</span><span class="nf">option</span> <span class="ss">:use-custom</span> <span class="p">[</span><span class="nv">n</span><span class="p">]</span> <span class="nv">n</span><span class="p">)</span>
       <span class="p">(</span><span class="nf">default</span> <span class="ss">:use-nil</span><span class="p">)))</span>

    <span class="p">(</span><span class="nf">on</span> <span class="ss">:odd-number</span> <span class="p">[]</span>
      <span class="p">(</span><span class="nf">escalate</span> <span class="ss">:odd-number</span>
        <span class="p">(</span><span class="nf">option</span> <span class="ss">:use-zero</span> <span class="p">[]</span> <span class="mi">0</span><span class="p">)</span>
        <span class="p">(</span><span class="nf">default</span> <span class="ss">:use-custom</span> <span class="ss">:nan</span><span class="p">)))))</span>

<span class="p">(</span><span class="nf">half-int-f</span> <span class="mi">3</span><span class="p">)</span> <span class="nv">=&gt;</span> <span class="ss">:nan</span>  <span class="c1">;; (instead of nil)</span>
<span class="p">(</span><span class="nf">mapv</span> <span class="nv">half-int-f</span> <span class="p">[</span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span><span class="p">])</span>

<span class="nv">=&gt;</span> <span class="p">[</span><span class="ss">:nan</span> <span class="mi">1</span> <span class="ss">:nan</span> <span class="mi">2</span><span class="p">]</span> <span class="c1">;; notice that the default is overridden</span>

<span class="p">(</span><span class="nf">manage</span>
  <span class="p">(</span><span class="nf">mapv</span> <span class="nv">half-int-f</span> <span class="p">[</span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span><span class="p">])</span>
  <span class="p">(</span><span class="nf">on</span> <span class="ss">:odd-number</span> <span class="p">[]</span>
    <span class="p">(</span><span class="nf">choose</span> <span class="ss">:use-zero</span><span class="p">)))</span>

<span class="nv">=&gt;</span> <span class="p">[</span><span class="mi">0</span> <span class="mi">1</span> <span class="mi">0</span> <span class="mi">2</span><span class="p">]</span>   <span class="c1">;; using an escalated option</span>
</pre></div>
</div><div><p>Options specified higher up are favored:</p></div><div><div class="highlight"><pre><span class="p">(</span><span class="nf">manage</span>
  <span class="p">(</span><span class="nf">mapv</span> <span class="nv">half-int-f</span> <span class="p">[</span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span><span class="p">])</span>
  <span class="p">(</span><span class="nf">on</span> <span class="ss">:odd-number</span> <span class="p">[]</span>
    <span class="p">(</span><span class="nf">choose</span> <span class="ss">:use-nil</span><span class="p">)))</span>

  <span class="nv">=&gt;</span> <span class="p">[</span><span class="nv">nil</span> <span class="mi">1</span> <span class="nv">nil</span> <span class="mi">2</span><span class="p">]</span>

  <span class="p">(</span><span class="nf">manage</span>
   <span class="p">(</span><span class="nf">mapv</span> <span class="nv">half-int-f</span> <span class="p">[</span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span><span class="p">])</span>
   <span class="p">(</span><span class="nf">on</span> <span class="ss">:odd-number</span> <span class="p">[]</span>
     <span class="p">(</span><span class="nf">choose</span> <span class="ss">:use-nil</span><span class="p">))</span>
   <span class="p">(</span><span class="nf">option</span> <span class="ss">:use-nil</span> <span class="p">[]</span> <span class="nv">nil</span><span class="p">))</span>

  <span class="nv">=&gt;</span> <span class="nv">nil</span>  <span class="c1">;; notice that the :use-nil is overridden</span>
</pre></div>
</div><div><a name="hooks"></a><h3>4.4 &nbsp;&nbsp; hooks</h3></div><div><p>When working with jvm libraries, there will always be exceptions. ribol provides macros to hook into thrown exceptions. Because all of the three methods are macros involving <code>try</code>, they all support the <code>finally</code> clause.</p></div><div><a name="raise-on"></a><h3><i>4.4.1 &nbsp;&nbsp; raise-on</i></h3></div><div><p><code>raise-on</code> hooks ribol into the java exception system. Once an exception is thrown, it can be turned into an issue:</p></div><div><div class="highlight"><pre><span class="p">(</span><span class="nf">raise-on</span> <span class="p">[</span><span class="nv">ArithmeticException</span> <span class="ss">:divide-by-zero</span><span class="p">]</span>
          <span class="p">(</span><span class="nb">/ </span><span class="mi">4</span> <span class="mi">2</span><span class="p">))</span>
<span class="nv">=&gt;</span> <span class="mi">2</span>

<span class="p">(</span><span class="nf">raise-on</span> <span class="p">[</span><span class="nv">ArithmeticException</span> <span class="ss">:divide-by-zero</span><span class="p">]</span>
          <span class="p">(</span><span class="nb">/ </span><span class="mi">1</span> <span class="mi">0</span><span class="p">))</span>
<span class="nv">=&gt;</span> <span class="p">(</span><span class="nf">raises-issue</span> <span class="p">{</span><span class="ss">:divide-by-zero</span> <span class="nv">true</span> 
                  <span class="ss">:origin</span> <span class="o">#</span><span class="p">(</span><span class="nb">instance? </span><span class="nv">ArithmeticException</span> <span class="nv">%</span><span class="p">)})</span>

<span class="p">(</span><span class="nf">manage</span>
 <span class="p">(</span><span class="nf">raise-on</span> <span class="p">[</span><span class="nv">ArithmeticException</span> <span class="ss">:divide-by-zero</span><span class="p">]</span>
           <span class="p">(</span><span class="nb">/ </span><span class="mi">1</span> <span class="mi">0</span><span class="p">))</span>
 <span class="p">(</span><span class="nf">on</span> <span class="ss">:divide-by-zero</span> <span class="p">[]</span>
     <span class="p">(</span><span class="nf">continue</span> <span class="ss">:infinity</span><span class="p">)))</span>
<span class="nv">=&gt;</span> <span class="ss">:infinity</span>
</pre></div>
</div><div><p>Any thrown clojure.lang.ExceptionInfo objects will be raised as issues.</p></div><div><div class="highlight"><pre><span class="p">(</span><span class="nf">raise-on</span> <span class="p">[]</span>
          <span class="p">(</span><span class="nf">throw</span> <span class="p">(</span><span class="nf">ex-info</span> <span class="s">&quot;&quot;</span> <span class="p">{</span><span class="ss">:a</span> <span class="mi">1</span> <span class="ss">:b</span> <span class="mi">2</span><span class="p">})))</span>
<span class="nv">=&gt;</span> <span class="p">(</span><span class="nf">raises-issue</span> <span class="p">{</span><span class="ss">:a</span> <span class="mi">1</span> <span class="ss">:b</span> <span class="mi">2</span>
                  <span class="ss">:origin</span> <span class="o">#</span><span class="p">(</span><span class="nb">= </span><span class="p">(</span><span class="nf">ex-data</span> <span class="nv">%</span><span class="p">)</span> <span class="p">{</span><span class="ss">:a</span> <span class="mi">1</span> <span class="ss">:b</span> <span class="mi">2</span><span class="p">})})</span>
</pre></div>
</div><div><p>Multiple exceptions are supported, as well as the finally clause.</p></div><div><div class="highlight"><pre><span class="p">(</span><span class="nf">raise-on</span> <span class="p">[[</span><span class="nv">NumberFormatException</span> <span class="nv">ArithmeticException</span><span class="p">]</span> <span class="ss">:divide-by-zero</span>
           <span class="nv">Throwable</span> <span class="ss">:throwing</span><span class="p">]</span>
          <span class="p">(</span><span class="nf">throw</span> <span class="p">(</span><span class="nf">Throwable.</span> <span class="s">&quot;oeuoeu&quot;</span><span class="p">))</span>
          <span class="p">(</span><span class="nf">finally</span> <span class="p">(</span><span class="nb">println </span><span class="mi">1</span><span class="p">)))</span>
<span class="nv">=&gt;</span> <span class="p">(</span><span class="nf">raises-issue</span> <span class="p">{</span><span class="ss">:throwing</span> <span class="nv">true</span>
                  <span class="ss">:origin</span> <span class="o">#</span><span class="p">(</span><span class="nb">instance? </span><span class="nv">Throwable</span> <span class="nv">%</span><span class="p">)})</span> <span class="c1">;; prints 1</span>
</pre></div>
</div><div><a name="raise-on-all"></a><h3><i>4.4.2 &nbsp;&nbsp; raise-on-all</i></h3></div><div><p><code>raise-on-all</code> will raise an issue on any <code>Throwable</code></p></div><div><div class="highlight"><pre><span class="p">(</span><span class="nf">manage</span>
 <span class="p">(</span><span class="nf">raise-on-all</span> <span class="ss">:error</span> <span class="p">(</span><span class="nb">/ </span><span class="mi">4</span> <span class="mi">2</span><span class="p">))</span>
 <span class="p">(</span><span class="nf">on</span> <span class="ss">:error</span> <span class="p">[]</span>
     <span class="p">(</span><span class="nf">continue</span> <span class="ss">:none</span><span class="p">)))</span>
<span class="nv">=&gt;</span> <span class="mi">2</span>

<span class="p">(</span><span class="nf">manage</span>
 <span class="p">(</span><span class="nf">raise-on-all</span> <span class="ss">:error</span> <span class="p">(</span><span class="nb">/ </span><span class="nv">nil</span> <span class="nv">nil</span><span class="p">))</span>
 <span class="p">(</span><span class="nf">on</span> <span class="ss">:error</span> <span class="p">[]</span>
     <span class="p">(</span><span class="nf">continue</span> <span class="ss">:none</span><span class="p">)))</span>
<span class="nv">=&gt;</span> <span class="ss">:none</span>
</pre></div>
</div><div><a name="anticipate"></a><h3><i>4.4.3 &nbsp;&nbsp; anticipate</i></h3></div><div><p><code>anticipate</code> is another way to perform try and catch. Instead catching exceptions at the bottom of the block, it is possible to anticipate what exceptions will occur and deal with them directly. Anticipate  also supports the <code>finally</code> clause</p></div><div><div class="highlight"><pre><span class="p">(</span><span class="nf">anticipate</span> <span class="p">[</span><span class="nv">ArithmeticException</span> <span class="ss">:infinity</span><span class="p">]</span>
            <span class="p">(</span><span class="nb">/ </span><span class="mi">1</span> <span class="mi">0</span><span class="p">))</span>
<span class="nv">=&gt;</span> <span class="ss">:infinity</span>

<span class="p">(</span><span class="nf">anticipate</span> <span class="p">[</span><span class="nv">ArithmeticException</span> <span class="ss">:infinity</span>
             <span class="nv">NullPointerException</span> <span class="ss">:null</span><span class="p">]</span>
            <span class="p">(</span><span class="nb">/ </span><span class="nv">nil</span> <span class="nv">nil</span><span class="p">))</span>
<span class="nv">=&gt;</span> <span class="ss">:null</span>
</pre></div>
</div><div><a name="control-strategies"></a><h2><b>5 &nbsp;&nbsp; Control Strategies</b></h2></div><div><p>This is a comprehensive (though non-exhaustive) list of program control strategies that can be used with <code>ribol</code>. It can be noted that the <code>try/catch</code> paradigm can implement sections <a href='#normal'>5.1</a> and <a href='#catch'>5.2</a>. Other clojure restart libraries such as <code>errorkit</code>, <code>swell</code> and <code>conditions</code> additionally implement sections <a href='#continue'>5.3</a>, <a href='#choose'>5.4</a> and <a href='#choose-more'>5.5</a>.</p><p><code>ribol</code> supports novel (and more natural) program control mechanics through the <code>escalate</code> (<a href='#escalate'>5.6</a>), <code>fail</code> (<a href='#fail'>5.7</a>) and  <code>default</code> (<a href='#default'>5.8</a>) special forms as well as branching support in the <code>on</code> special form (<a href='#on-form'>5.9</a>).</p></div><div><a name="normal"></a><h3>5.1 &nbsp;&nbsp; Normal</h3></div><div><a name="no-raise"></a><h3><i>5.1.1 &nbsp;&nbsp; No Raise</i></h3></div><div><p>The most straightforward code is one where no issues raised:</p></div><div><a name="ribol-normal-eq"></a><h4><i>e.5.1  &nbsp;-&nbsp; No Issues</i></h4><div class="highlight"><pre><span class="p">(</span><span class="nf">manage</span>                          <span class="c1">;; L2</span>
  <span class="p">[</span><span class="mi">1</span> <span class="mi">2</span> <span class="p">(</span><span class="nf">manage</span> <span class="mi">3</span><span class="p">)])</span>              <span class="c1">;; L1 and L0</span>

<span class="nv">=&gt;</span> <span class="p">[</span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span><span class="p">]</span>
</pre></div>
</div><div class="figure"><h4><i>fig.1  &nbsp;-&nbsp; No Issues Flow</i></h4><div class="img"><img height="300px" src="img/norm_normal.png" title="No Issues Flow" /></div><p /></div><div><a name="issue-raised"></a><h3><i>5.1.2 &nbsp;&nbsp; Issue Raised</i></h3></div><div><p>If there is an issue raised with no handler, it will <code>throw</code> an exception.</p></div><div><a name="unmanaged-issue"></a><h4><i>e.5.2  &nbsp;-&nbsp; Unmanaged Issue</i></h4><div class="highlight"><pre><span class="p">(</span><span class="nf">manage</span>                          <span class="c1">;; L2</span>
 <span class="p">[</span><span class="mi">1</span> <span class="mi">2</span> <span class="p">(</span><span class="nf">manage</span>                    <span class="c1">;; L1</span>
       <span class="p">(</span><span class="nf">raise</span> <span class="p">{</span><span class="ss">:A</span> <span class="nv">true</span><span class="p">}))])</span>      <span class="c1">;; L0</span>

<span class="nv">=&gt;</span> <span class="p">(</span><span class="nf">raises-issue</span> <span class="p">{</span><span class="ss">:A</span> <span class="nv">true</span><span class="p">})</span>
</pre></div>
</div><div class="figure"><h4><i>fig.2  &nbsp;-&nbsp; Unmanaged Issue Flow</i></h4><div class="img"><img height="300px" src="img/norm_unmanaged.png" title="Unmanaged Issue Flow" /></div><p /></div><div><a name="catch"></a><h3>5.2 &nbsp;&nbsp; Catch</h3></div><div><p>Once an issue has been raised, it can be handled within a managed scope through the use of 'on'. 'manage/on' is the equivalent to 'try/catch' in the following two cases:</p></div><div><a name="first-level-catch"></a><h3><i>5.2.1 &nbsp;&nbsp; First Level Catch</i></h3></div><div><a name="catch-on-:a"></a><h4><i>e.5.3  &nbsp;-&nbsp; Catch on :A</i></h4><div class="highlight"><pre><span class="p">(</span><span class="nf">manage</span>                          <span class="c1">;; L2</span>
 <span class="p">[</span><span class="mi">1</span> <span class="mi">2</span> <span class="p">(</span><span class="nf">manage</span>                    <span class="c1">;; L1</span>
       <span class="p">(</span><span class="nf">raise</span> <span class="ss">:A</span><span class="p">)</span>                <span class="c1">;; L0</span>
       <span class="p">(</span><span class="nf">on</span> <span class="ss">:A</span> <span class="p">[]</span> <span class="ss">:A</span><span class="p">))]</span>           <span class="c1">;; H1A</span>
 <span class="p">(</span><span class="nf">on</span> <span class="ss">:B</span> <span class="p">[]</span> <span class="ss">:B</span><span class="p">))</span>                  <span class="c1">;; H2B</span>

<span class="nv">=&gt;</span> <span class="p">[</span><span class="mi">1</span> <span class="mi">2</span> <span class="ss">:A</span><span class="p">]</span>
</pre></div>
</div><div class="figure"><h4><i>fig.3  &nbsp;-&nbsp; Catch on :A Flow</i></h4><div class="img"><img height="300px" src="img/catch_flow_a.png" title="Catch on :A Flow" /></div><p /></div><div><a name="second-level-catch"></a><h3><i>5.2.2 &nbsp;&nbsp; Second Level Catch</i></h3></div><div><a name="catch-on-:b"></a><h4><i>e.5.4  &nbsp;-&nbsp; Catch on :B</i></h4><div class="highlight"><pre><span class="p">(</span><span class="nf">manage</span>                          <span class="c1">;; L2</span>
 <span class="p">[</span><span class="mi">1</span> <span class="mi">2</span> <span class="p">(</span><span class="nf">manage</span>                    <span class="c1">;; L1</span>
       <span class="p">(</span><span class="nf">raise</span> <span class="ss">:B</span><span class="p">)</span>                <span class="c1">;; L0</span>
       <span class="p">(</span><span class="nf">on</span> <span class="ss">:A</span> <span class="p">[]</span> <span class="ss">:A</span><span class="p">))]</span>           <span class="c1">;; H1A</span>
 <span class="p">(</span><span class="nf">on</span> <span class="ss">:B</span> <span class="p">[]</span> <span class="ss">:B</span><span class="p">))</span>                  <span class="c1">;; H2B</span>

<span class="nv">=&gt;</span> <span class="ss">:B</span>
</pre></div>
</div><div class="figure"><h4><i>fig.4  &nbsp;-&nbsp; Catch on :B Flow</i></h4><div class="img"><img height="300px" src="img/catch_flow_b.png" title="Catch on :B Flow" /></div><p /></div><div><a name="continue"></a><h3>5.3 &nbsp;&nbsp; Continue</h3></div><div><p>The 'continue' form signals that the program    should resume at the point that the issue    was raised.</p></div><div><a name="first-level-continue"></a><h3><i>5.3.1 &nbsp;&nbsp; First Level Continue</i></h3></div><div><p>In the first case, this gives the same result as <code>try/catch</code>.</p></div><div><a name="continue-on-:a"></a><h4><i>e.5.5  &nbsp;-&nbsp; Continue on :A</i></h4><div class="highlight"><pre><span class="p">(</span><span class="nf">manage</span>                          <span class="c1">;; L2</span>
 <span class="p">[</span><span class="mi">1</span> <span class="mi">2</span> <span class="p">(</span><span class="nf">manage</span>                    <span class="c1">;; L1</span>
       <span class="p">(</span><span class="nf">raise</span> <span class="ss">:A</span><span class="p">)</span>                <span class="c1">;; L0</span>
       <span class="p">(</span><span class="nf">on</span> <span class="ss">:A</span> <span class="p">[]</span>                 <span class="c1">;; H1A</span>
           <span class="p">(</span><span class="nf">continue</span> <span class="ss">:3A</span><span class="p">)))]</span>
 <span class="p">(</span><span class="nf">on</span> <span class="ss">:B</span> <span class="p">[]</span>                       <span class="c1">;; H2B</span>
     <span class="p">(</span><span class="nf">continue</span> <span class="ss">:3B</span><span class="p">)))</span>

<span class="nv">=&gt;</span> <span class="p">[</span><span class="mi">1</span> <span class="mi">2</span> <span class="ss">:3A</span><span class="p">]</span>
</pre></div>
</div><div class="figure"><h4><i>fig.5  &nbsp;-&nbsp; Continue on :A Flow</i></h4><div class="img"><img height="300px" src="img/continue_flow_a.png" title="Continue on :A Flow" /></div><p /></div><div><a name="second-level-continue"></a><h3><i>5.3.2 &nbsp;&nbsp; Second Level Continue</i></h3></div><div><p>However, it can be seen that when 'continue' is used    on the outer manage blocks, it provides the 'manage/on'    a way for top tier forms to affect the bottom tier forms    without manipulating logic in the middle tier</p></div><div><a name="continue-on-:b"></a><h4><i>e.5.6  &nbsp;-&nbsp; Continue on :B</i></h4><div class="highlight"><pre><span class="p">(</span><span class="nf">manage</span>                          <span class="c1">;; L2</span>
 <span class="p">[</span><span class="mi">1</span> <span class="mi">2</span> <span class="p">(</span><span class="nf">manage</span>                    <span class="c1">;; L1</span>
       <span class="p">(</span><span class="nf">raise</span> <span class="ss">:B</span><span class="p">)</span>                <span class="c1">;; L0</span>
       <span class="p">(</span><span class="nf">on</span> <span class="ss">:A</span> <span class="p">[]</span>                 <span class="c1">;; H1A</span>
           <span class="p">(</span><span class="nf">continue</span> <span class="ss">:3A</span><span class="p">)))]</span>
 <span class="p">(</span><span class="nf">on</span> <span class="ss">:B</span> <span class="p">[]</span>                       <span class="c1">;; H2B</span>
     <span class="p">(</span><span class="nf">continue</span> <span class="ss">:3B</span><span class="p">)))</span>

<span class="nv">=&gt;</span> <span class="p">[</span><span class="mi">1</span> <span class="mi">2</span> <span class="ss">:3B</span><span class="p">]</span>
</pre></div>
</div><div class="figure"><h4><i>fig.6  &nbsp;-&nbsp; Continue on :B Flow</i></h4><div class="img"><img height="300px" src="img/continue_flow_b.png" title="Continue on :B Flow" /></div><p /></div><div><a name="choose"></a><h3>5.4 &nbsp;&nbsp; Choose</h3></div><div><p><code>choose</code> and <code>option</code> work together within manage scopes. A raised issue can have options attached to it, just a worker might give their manager certain options to choose from when an unexpected issue arises. Options can be chosen that lie anywhere within the manage blocks.</p></div><div><a name="choose-lower-level"></a><h3><i>5.4.1 &nbsp;&nbsp; Choose Lower-Level</i></h3></div><div><a name="choose-:x"></a><h4><i>e.5.7  &nbsp;-&nbsp; Choose :X</i></h4><div class="highlight"><pre><span class="p">(</span><span class="nf">manage</span>                           <span class="c1">;; L2</span>
 <span class="p">[</span><span class="mi">1</span> <span class="mi">2</span> <span class="p">(</span><span class="nf">manage</span>                     <span class="c1">;; L1</span>
        <span class="p">(</span><span class="nf">raise</span> <span class="ss">:A</span>                  <span class="c1">;; L0</span>
               <span class="p">(</span><span class="nf">option</span> <span class="ss">:X</span> <span class="p">[]</span> <span class="ss">:3X</span><span class="p">))</span> <span class="c1">;; X</span>
        <span class="p">(</span><span class="nf">on</span> <span class="ss">:A</span> <span class="p">[]</span>                  <span class="c1">;; H1A</span>
            <span class="p">(</span><span class="nf">choose</span> <span class="ss">:X</span><span class="p">))</span>
        <span class="p">(</span><span class="nf">option</span> <span class="ss">:Y</span> <span class="p">[]</span> <span class="ss">:3Y</span><span class="p">))]</span>       <span class="c1">;; Y</span>
   <span class="p">(</span><span class="nf">option</span> <span class="ss">:Z</span> <span class="p">[]</span> <span class="ss">:3Z</span><span class="p">))</span>              <span class="c1">;; Z</span>

<span class="nv">=&gt;</span> <span class="p">[</span><span class="mi">1</span> <span class="mi">2</span> <span class="ss">:3X</span><span class="p">]</span>
</pre></div>
</div><div class="figure"><h4><i>fig.7  &nbsp;-&nbsp; Choose :X Flow</i></h4><div class="img"><img height="300px" src="img/choose_flow_x.png" title="Choose :X Flow" /></div><p /></div><div><p>However in some cases, upper level options can be accessed as in this case. This can be used to set global strategies to deal with very issues that have serious consequences if it was to go ahead.</p><p>   An example maybe a mine worker who finds a gas-leak. Because of previously conveyed instructions, he doesn't need to inform his manager and shuts down the plant immediately.</p></div><div><a name="choose-upper-level"></a><h3><i>5.4.2 &nbsp;&nbsp; Choose Upper-Level</i></h3></div><div><a name="choose-:z"></a><h4><i>e.5.8  &nbsp;-&nbsp; Choose :Z</i></h4><div class="highlight"><pre><span class="p">(</span><span class="nf">manage</span>                           <span class="c1">;; L2</span>
 <span class="p">[</span><span class="mi">1</span> <span class="mi">2</span> <span class="p">(</span><span class="nf">manage</span>                     <span class="c1">;; L1</span>
       <span class="p">(</span><span class="nf">raise</span> <span class="ss">:A</span>                  <span class="c1">;; L0</span>
              <span class="p">(</span><span class="nf">option</span> <span class="ss">:X</span> <span class="p">[]</span> <span class="ss">:3X</span><span class="p">))</span> <span class="c1">;; X</span>
       <span class="p">(</span><span class="nf">on</span> <span class="ss">:A</span> <span class="p">[]</span>                  <span class="c1">;; H1A</span>
           <span class="p">(</span><span class="nf">choose</span> <span class="ss">:Z</span><span class="p">))</span>
       <span class="p">(</span><span class="nf">option</span> <span class="ss">:Y</span> <span class="p">[]</span> <span class="ss">:3Y</span><span class="p">))]</span>       <span class="c1">;; Y</span>
 <span class="p">(</span><span class="nf">option</span> <span class="ss">:Z</span> <span class="p">[]</span> <span class="ss">:3Z</span><span class="p">))</span>              <span class="c1">;; Z</span>

<span class="nv">=&gt;</span> <span class="ss">:3Z</span>
</pre></div>
</div><div class="figure"><h4><i>fig.8  &nbsp;-&nbsp; Choose :Z Flow</i></h4><div class="img"><img height="300px" src="img/choose_flow_z.png" title="Choose :Z Flow" /></div><p /></div><div><a name="choose-more"></a><h3>5.5 &nbsp;&nbsp; Choose - More Strategies</h3></div><div><a name="overridding-an-option"></a><h3><i>5.5.1 &nbsp;&nbsp; Overridding An Option</i></h3></div><div><p>If there are two options with the same label,   choose will take the option specified at the highest   management level. This means that managers at higher   levels can over-ride lower level strategies.</p></div><div><a name="choose-:x1"></a><h4><i>e.5.9  &nbsp;-&nbsp; Choose :X1</i></h4><div class="highlight"><pre><span class="p">(</span><span class="nf">manage</span>                            <span class="c1">;; L2</span>
 <span class="p">[</span><span class="mi">1</span> <span class="mi">2</span> <span class="p">(</span><span class="nf">manage</span>                      <span class="c1">;; L1</span>
       <span class="p">(</span><span class="nf">raise</span> <span class="ss">:A</span>                   <span class="c1">;; L0</span>
              <span class="p">(</span><span class="nf">option</span> <span class="ss">:X</span> <span class="p">[]</span> <span class="ss">:3X0</span><span class="p">))</span> <span class="c1">;; X0 - This is ignored</span>
       <span class="p">(</span><span class="nf">on</span> <span class="ss">:A</span> <span class="p">[]</span>                   <span class="c1">;; H1A</span>
         <span class="p">(</span><span class="nf">choose</span> <span class="ss">:X</span><span class="p">))</span>
       <span class="p">(</span><span class="nf">option</span> <span class="ss">:X</span> <span class="p">[]</span> <span class="ss">:3X1</span><span class="p">))]</span>       <span class="c1">;; X1 - This is chosen</span>
 <span class="p">(</span><span class="nf">option</span> <span class="ss">:Z</span> <span class="p">[]</span> <span class="ss">:3Z</span><span class="p">))</span>               <span class="c1">;; Z</span>

<span class="nv">=&gt;</span> <span class="p">[</span><span class="mi">1</span> <span class="mi">2</span> <span class="ss">:3X1</span><span class="p">]</span>
</pre></div>
</div><div class="figure"><h4><i>fig.9  &nbsp;-&nbsp; Choose :X1 Flow</i></h4><div class="img"><img height="300px" src="img/choose_flow_x1.png" title="Choose :X1 Flow" /></div><p /></div><div><a name="default-option"></a><h3><i>5.5.2 &nbsp;&nbsp; Default Option</i></h3></div><div><p>Specifying a 'default' option allows the raiser to    have autonomous control of the situation if the issue    remains unhandled.</p></div><div><a name="choose-default"></a><h4><i>e.5.10  &nbsp;-&nbsp; Choose Default</i></h4><div class="highlight"><pre><span class="p">(</span><span class="nf">manage</span>                            <span class="c1">;; L2</span>
 <span class="p">[</span><span class="mi">1</span> <span class="mi">2</span> <span class="p">(</span><span class="nf">manage</span>                      <span class="c1">;; L1</span>
       <span class="p">(</span><span class="nf">raise</span> <span class="ss">:A</span>                   <span class="c1">;; L0</span>
              <span class="p">(</span><span class="nf">default</span> <span class="ss">:X</span><span class="p">)</span>         <span class="c1">;; D</span>
              <span class="p">(</span><span class="nf">option</span> <span class="ss">:X</span> <span class="p">[]</span> <span class="ss">:3X</span><span class="p">))</span>  <span class="c1">;; X</span>
       <span class="p">(</span><span class="nf">option</span> <span class="ss">:Y</span> <span class="p">[]</span> <span class="ss">:3Y</span><span class="p">))]</span>        <span class="c1">;; Y</span>
 <span class="p">(</span><span class="nf">option</span> <span class="ss">:Z</span> <span class="p">[]</span> <span class="ss">:3Z</span><span class="p">))</span>               <span class="c1">;; Z</span>

<span class="nv">=&gt;</span> <span class="p">[</span><span class="mi">1</span> <span class="mi">2</span> <span class="ss">:3X</span><span class="p">]</span>
</pre></div>
</div><div class="figure"><h4><i>fig.10  &nbsp;-&nbsp; Choose Default Flow</i></h4><div class="img"><img height="300px" src="img/choose_default_x.png" title="Choose Default Flow" /></div><p /></div><div><a name="overriding-defaults"></a><h3><i>5.5.3 &nbsp;&nbsp; Overriding Defaults</i></h3></div><div><p>This is an example of higher-tier managers    overriding options</p></div><div><a name="choose-default-:x2"></a><h4><i>e.5.11  &nbsp;-&nbsp; Choose Default :X2</i></h4><div class="highlight"><pre><span class="p">(</span><span class="nf">manage</span>                            <span class="c1">;; L2</span>
 <span class="p">[</span><span class="mi">1</span> <span class="mi">2</span> <span class="p">(</span><span class="nf">manage</span>                      <span class="c1">;; L1</span>
       <span class="p">(</span><span class="nf">raise</span> <span class="ss">:A</span>                   <span class="c1">;; L0</span>
              <span class="p">(</span><span class="nf">default</span> <span class="ss">:X</span><span class="p">)</span>         <span class="c1">;; D</span>
              <span class="p">(</span><span class="nf">option</span> <span class="ss">:X</span> <span class="p">[]</span> <span class="ss">:3X0</span><span class="p">))</span> <span class="c1">;; X0</span>
       <span class="p">(</span><span class="nf">option</span> <span class="ss">:X</span> <span class="p">[]</span> <span class="ss">:3X1</span><span class="p">))]</span>       <span class="c1">;; X1</span>
  <span class="p">(</span><span class="nf">option</span> <span class="ss">:X</span> <span class="p">[]</span> <span class="ss">:3X2</span><span class="p">))</span>             <span class="c1">;; X2</span>

<span class="nv">=&gt;</span> <span class="ss">:3X2</span>
</pre></div>
</div><div class="figure"><h4><i>fig.11  &nbsp;-&nbsp; Choose Default :X2 Flow</i></h4><div class="img"><img height="300px" src="img/choose_default_x2.png" title="Choose Default :X2 Flow" /></div><p /></div><div><a name="escalate"></a><h3>5.6 &nbsp;&nbsp; Escalate</h3></div><div><a name="simple-escalation"></a><h3><i>5.6.1 &nbsp;&nbsp; Simple Escalation</i></h3></div><div><p>When issues are escalated, more information    can be added and this then is passed on to    higher-tier managers</p></div><div><a name="escalate-:b"></a><h4><i>e.5.12  &nbsp;-&nbsp; Escalate :B</i></h4><div class="highlight"><pre><span class="p">(</span><span class="nf">manage</span>                            <span class="c1">;; L2</span>
 <span class="p">[</span><span class="mi">1</span> <span class="mi">2</span> <span class="p">(</span><span class="nf">manage</span>                      <span class="c1">;; L1</span>
       <span class="p">(</span><span class="nf">raise</span> <span class="ss">:A</span><span class="p">)</span>                  <span class="c1">;; L0</span>
       <span class="p">(</span><span class="nf">on</span> <span class="ss">:A</span> <span class="p">[]</span>                   <span class="c1">;; H1A</span>
          <span class="p">(</span><span class="nf">escalate</span> <span class="ss">:B</span><span class="p">)))]</span>
 <span class="p">(</span><span class="nf">on</span> <span class="ss">:B</span> <span class="p">[]</span>                         <span class="c1">;; H2B</span>
     <span class="p">(</span><span class="nf">continue</span> <span class="ss">:3B</span><span class="p">)))</span>

<span class="nv">=&gt;</span> <span class="p">[</span><span class="mi">1</span> <span class="mi">2</span> <span class="ss">:3B</span><span class="p">]</span>
</pre></div>
</div><div class="figure"><h4><i>fig.12  &nbsp;-&nbsp; Escalate :B Flow</i></h4><div class="img"><img height="300px" src="img/escalate_norm.png" title="Escalate :B Flow" /></div><p /></div><div><a name="escalation-with-options"></a><h3><i>5.6.2 &nbsp;&nbsp; Escalation with Options</i></h3></div><div><p>More options can be added to escalate. When   these options are chosen, it will continue at the   point in which the issue was raised.</p></div><div><a name="escalate-:b,-choose-:x"></a><h4><i>e.5.13  &nbsp;-&nbsp; Escalate :B, Choose :X</i></h4><div class="highlight"><pre><span class="p">(</span><span class="nf">manage</span>                            <span class="c1">;; L2</span>
 <span class="p">[</span><span class="mi">1</span> <span class="mi">2</span> <span class="p">(</span><span class="nf">manage</span>                      <span class="c1">;; L1</span>
       <span class="p">(</span><span class="nf">raise</span> <span class="ss">:A</span><span class="p">)</span>                  <span class="c1">;; L0</span>
       <span class="p">(</span><span class="nf">on</span> <span class="ss">:A</span> <span class="p">[]</span>                   <span class="c1">;; H1A</span>
           <span class="p">(</span><span class="nf">escalate</span>
            <span class="ss">:B</span>
            <span class="p">(</span><span class="nf">option</span> <span class="ss">:X</span> <span class="p">[]</span> <span class="ss">:3X</span><span class="p">))))]</span> <span class="c1">;; X</span>
  <span class="p">(</span><span class="nf">on</span> <span class="ss">:B</span> <span class="p">[]</span>                        <span class="c1">;; H2B</span>
      <span class="p">(</span><span class="nf">choose</span> <span class="ss">:X</span><span class="p">)))</span>

<span class="nv">=&gt;</span> <span class="p">[</span><span class="mi">1</span> <span class="mi">2</span> <span class="ss">:3X</span><span class="p">]</span>
</pre></div>
</div><div class="figure"><h4><i>fig.13  &nbsp;-&nbsp; Escalate :B, Choose :X Flow</i></h4><div class="img"><img height="300px" src="img/escalate_options.png" title="Escalate :B, Choose :X Flow" /></div><p /></div><div><a name="fail"></a><h3>5.7 &nbsp;&nbsp; Fail</h3></div><div><p>Fail forces a failure. It is used where there is already a default    option and the manager really needs it to fail.</p></div><div><a name="force-failure"></a><h4><i>e.5.14  &nbsp;-&nbsp; Force Failure</i></h4><div class="highlight"><pre><span class="p">(</span><span class="nf">manage</span>                          <span class="c1">;; L2</span>
 <span class="p">[</span><span class="mi">1</span> <span class="mi">2</span> <span class="p">(</span><span class="nf">manage</span>                    <span class="c1">;; L1</span>
       <span class="p">(</span><span class="nf">raise</span> <span class="ss">:A</span>                 <span class="c1">;; L0</span>
              <span class="p">(</span><span class="nf">option</span> <span class="ss">:X</span> <span class="p">[]</span> <span class="ss">:X</span><span class="p">)</span>
              <span class="p">(</span><span class="nf">default</span> <span class="ss">:X</span><span class="p">))</span>
       <span class="p">(</span><span class="nf">on</span> <span class="ss">:A</span> <span class="p">[]</span>                 <span class="c1">;; H1A</span>
           <span class="p">(</span><span class="nf">fail</span> <span class="ss">:B</span><span class="p">)))])</span>

<span class="nv">=&gt;</span> <span class="p">(</span><span class="nf">raises-issue</span> <span class="p">{</span><span class="ss">:A</span> <span class="nv">true</span> <span class="ss">:B</span> <span class="nv">true</span><span class="p">})</span>
</pre></div>
</div><div class="figure"><h4><i>fig.14  &nbsp;-&nbsp; Force Fail Flow</i></h4><div class="img"><img height="300px" src="img/fail.png" title="Force Fail Flow" /></div><p /></div><div><a name="default"></a><h3>5.8 &nbsp;&nbsp; Default</h3></div><div><p>Default short-circuits higher managers so that    the issue is resolved internally.</p></div><div><a name="force-default"></a><h4><i>e.5.15  &nbsp;-&nbsp; Force Default</i></h4><div class="highlight"><pre><span class="p">(</span><span class="nf">manage</span>                          <span class="c1">;; L2</span>
 <span class="p">[</span><span class="mi">1</span> <span class="mi">2</span> <span class="p">(</span><span class="nf">manage</span>                    <span class="c1">;; L1</span>
       <span class="p">(</span><span class="nf">raise</span> <span class="ss">:A</span>                 <span class="c1">;; L0</span>
              <span class="p">(</span><span class="nf">option</span> <span class="ss">:X</span> <span class="p">[]</span> <span class="ss">:X</span><span class="p">)</span>
              <span class="p">(</span><span class="nf">default</span> <span class="ss">:X</span><span class="p">))</span>
       <span class="p">(</span><span class="nf">on</span> <span class="ss">:A</span> <span class="p">[]</span>                  <span class="c1">;; H1A</span>
           <span class="p">(</span><span class="nf">default</span><span class="p">)))]</span>
 <span class="p">(</span><span class="nf">on</span> <span class="ss">:A</span> <span class="p">[]</span> <span class="p">(</span><span class="nf">continue</span> <span class="mi">3</span><span class="p">)))</span>

<span class="nv">=&gt;</span> <span class="p">[</span><span class="mi">1</span> <span class="mi">2</span> <span class="ss">:X</span><span class="p">]</span>
</pre></div>
</div><div><a name="escalation-with-defaults"></a><h3><i>5.8.1 &nbsp;&nbsp; Escalation with Defaults</i></h3></div><div><p>This is <code>default</code> in combination with <code>escalate</code> to do some very complex jumping around.</p></div><div><a name="escalate-:b,-choose-default"></a><h4><i>e.5.16  &nbsp;-&nbsp; Escalate :B, Choose Default</i></h4><div class="highlight"><pre><span class="p">(</span><span class="nf">manage</span>                            <span class="c1">;; L2</span>
 <span class="p">[</span><span class="mi">1</span> <span class="mi">2</span> <span class="p">(</span><span class="nf">manage</span>                      <span class="c1">;; L1</span>
       <span class="p">(</span><span class="nf">raise</span> <span class="ss">:A</span>                   <span class="c1">;; L0</span>
         <span class="p">(</span><span class="nf">option</span> <span class="ss">:X</span> <span class="p">[]</span> <span class="ss">:X</span><span class="p">))</span>        <span class="c1">;; X</span>
       <span class="p">(</span><span class="nf">on</span> <span class="ss">:A</span> <span class="p">[]</span>                   <span class="c1">;; H1A</span>
           <span class="p">(</span><span class="nf">escalate</span>
            <span class="ss">:B</span>
            <span class="p">(</span><span class="nf">default</span> <span class="ss">:X</span><span class="p">))))]</span>       <span class="c1">;; D1</span>
  <span class="p">(</span><span class="nf">on</span> <span class="ss">:B</span> <span class="p">[]</span>                        <span class="c1">;; H2B</span>
      <span class="p">(</span><span class="nf">default</span><span class="p">)))</span>

<span class="nv">=&gt;</span> <span class="p">[</span><span class="mi">1</span> <span class="mi">2</span> <span class="ss">:X</span><span class="p">]</span>
</pre></div>
</div><div class="figure"><h4><i>fig.15  &nbsp;-&nbsp; Escalate :B, Choose Default Flow</i></h4><div class="img"><img height="300px" src="img/escalate_default_x2.png" title="Escalate :B, Choose Default Flow" /></div><p /></div><div><a name="on-form"></a><h3>5.9 &nbsp;&nbsp; Branch Using On</h3></div><div><p>Ribol strategies can also be combined within the <code>on</code> handler. In the following example, it can be seen that the <code>on :error</code> handler supports both <code>escalate</code> and <code>continue</code> strategies.</p></div><div><a name="input-dependent-branching"></a><h4><i>e.5.17  &nbsp;-&nbsp; Input Dependent Branching</i></h4><div class="highlight"><pre><span class="p">(</span><span class="nf">manage</span> <span class="p">(</span><span class="nf">manage</span>
         <span class="p">(</span><span class="nf">mapv</span> <span class="p">(</span><span class="k">fn </span><span class="p">[</span><span class="nv">n</span><span class="p">]</span>
                 <span class="p">(</span><span class="nf">raise</span> <span class="p">[</span><span class="ss">:error</span> <span class="p">{</span><span class="ss">:data</span> <span class="nv">n</span><span class="p">}]))</span>
               <span class="p">[</span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span> <span class="mi">7</span> <span class="mi">8</span><span class="p">])</span>
         <span class="p">(</span><span class="nf">on</span> <span class="ss">:error</span> <span class="p">[</span><span class="nv">data</span><span class="p">]</span>
             <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">&gt; </span><span class="nv">data</span> <span class="mi">5</span><span class="p">)</span>
               <span class="p">(</span><span class="nf">escalate</span> <span class="ss">:too-big</span><span class="p">)</span>
               <span class="p">(</span><span class="nf">continue</span> <span class="nv">data</span><span class="p">))))</span>
        <span class="p">(</span><span class="nf">on</span> <span class="ss">:too-big</span> <span class="p">[</span><span class="nv">data</span><span class="p">]</span>
            <span class="p">(</span><span class="nf">continue</span> <span class="p">(</span><span class="nb">- </span><span class="nv">data</span><span class="p">))))</span>

<span class="nv">=&gt;</span> <span class="p">[</span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">-6</span> <span class="mi">-7</span> <span class="mi">-8</span><span class="p">]</span>
</pre></div>
</div><div><p>Using branching strategies with <code>on</code> much more complex interactions can be constructed beyond the scope of this document.</p></div><div><a name="implementation"></a><h2><b>6 &nbsp;&nbsp; Implementation</b></h2></div><div><a name="the-workplace"></a><h3>6.1 &nbsp;&nbsp; The Workplace</h3></div><div><p>Two macros - <code>raise</code> and <code>manage</code> work together in creating the illusion of allowing code to seemingly jump around between higher and lower level functions. This in reality is not the case at all. We revisit the analogy of the worker who comes across something in their everyday routine that they cannot process.</p></div><div><a name="the-dumb-throw"></a><h3><i>6.1.1 &nbsp;&nbsp; The dumb throw</i></h3></div><div><p>When <code>&#40;throw .....&#41;</code> is invoked, the worker basically says: <em>'Dude, I quit! You deal with it'</em> and lets higher up managers deal with the consequences.</p></div><div class="figure"><h4><i>fig.16  &nbsp;-&nbsp; Lazy Worker</i></h4><div class="img"><img height="300px" src="img/work_throw.png" title="Lazy Worker" /></div><p /></div><div><a name="the-smart-raise"></a><h3><i>6.1.2 &nbsp;&nbsp; The smart raise</i></h3></div><div><p>When <code>&#40;raise ....&#41;</code> is used, the worker will attempt to notify their manager and ask for instructions. Only when there are no instructions forthcoming will they quit:</p></div><div><a name="continue-example"></a><h4><i>e.6.1  &nbsp;-&nbsp; Continue Example</i></h4><div class="highlight"><pre><span class="p">(</span><span class="kd">defn </span><span class="nv">dislike-odd</span> <span class="p">[</span><span class="nv">n</span><span class="p">]</span>
  <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nf">odd?</span> <span class="nv">n</span><span class="p">)</span> <span class="p">(</span><span class="nf">raise</span> <span class="ss">:error</span><span class="p">)</span> <span class="nv">n</span><span class="p">))</span>

<span class="p">(</span><span class="nf">manage</span>
 <span class="p">(</span><span class="nf">mapv</span> <span class="nv">dislike-odd</span> <span class="p">(</span><span class="nb">range </span><span class="mi">10</span><span class="p">))</span>
 <span class="p">(</span><span class="nf">on</span> <span class="ss">:error</span> <span class="p">[]</span> <span class="p">(</span><span class="nf">continue</span> <span class="ss">:odd</span><span class="p">)))</span>
<span class="nv">=&gt;</span> <span class="p">[</span><span class="mi">0</span> <span class="ss">:odd</span> <span class="mi">2</span> <span class="ss">:odd</span> <span class="mi">4</span> <span class="ss">:odd</span> <span class="mi">6</span> <span class="ss">:odd</span> <span class="mi">8</span> <span class="ss">:odd</span><span class="p">]</span>
</pre></div>
</div><div><p>Purely from looking at the example code, it reads:<ul><li>perform <code>mapv</code> of <code>dislike-odd</code> over the range of 0 to 10</li><li>if <code>:error</code> is raised by <code>dislike-odd</code>, tell <code>dislike-odd</code> to proceed at the point that the error was raised, using the value <code>:odd</code> instead.</li></ul></div><div class="figure"><h4><i>fig.17  &nbsp;-&nbsp; Smart Worker</i></h4><div class="img"><img height="300px" src="img/work_raise.png" title="Smart Worker" /></div><p /></div><div><p>Anytime there is an odd input to <code>dislike-odd</code>, the code seemingly jumps out to the context of the manager and having handled the issue, the code then seemingly jumps back into the function again.</p><p>Note the words <code>seemingly</code>. This is how we as programmers should be thinking about the problem as we write code to handle these type of issues. We are tricked for our own good because it makes us able to better reason about our programs without having to deal with the implementation details.</p><p>However, we are naturally suspicious of this from a performance point of view. If we don't know the mechanism, we ask ourselves... won`t all this jumping around make our code slower?</p></div><div><a name="the-proactive-workplace"></a><h3><i>6.1.3 &nbsp;&nbsp; The proactive workplace</i></h3></div><div><p>In reality, the program never left the place where <code>raise</code> was called. There was no saving of the stack or anything fancy. The <code>raise/continue</code> combination was an <em>illusion</em> of a jump. There was no jump. Calling <code>raise/continue</code> is most likely computationally cheaper than <code>try/catch</code>.</p><p>Going back to the workplace analogy, another way to manage exceptional circumstances is to have a prearranged noticeboard of what to do when things go wrong. Managers can write/override different ways to handle an issue on this board proactively. The worker, when encountering an issue, would go look at the board first to decide upon the best course of action to take. Only when there are no matching solutions to the issue will they solve it themselves or give up and quit. In this way, managers will not have to be called everytime something came up. This is the same mechanism of control that <code>ribol</code> uses.</p></div><div class="figure"><h4><i>fig.18  &nbsp;-&nbsp; Proactive Management</i></h4><div class="img"><img height="300px" src="img/work_board.png" title="Proactive Management" /></div><p /></div><div><a name="the-issue-management-board"></a><h3>6.2 &nbsp;&nbsp; The Issue Management Board</h3></div><div><p>We look at what happens when there is such an Issue Management Board put in place. <code>raise</code> is called. The worker will look at the board, starting with lowest level manager and proceeding up the management chain to see what strategies has to be been put into place. In the case of <a href='#continue-example'>e.6.1</a>, there would have been a handler already registered on the board to deal with the <code>:error</code>. The worker will pass any arguments of the issue to the handler function and then return with the result.</p></div><div class="figure"><h4><i>fig.19</i></h4><div class="img"><img height="300px" src="img/notice_board.png" /></div><p /></div><div><p>The management does not even need to know that an exception has occured because they have been proactive.</p></div><div><a name="control-flow-as-data"></a><h3><i>6.2.1 &nbsp;&nbsp; Control Flow as Data</i></h3></div><div><p>Whilst the <code>raise/continue</code> mechanism was decribed in brief, a bit more explanation is required to understand how different forms of jumps occur. Ribol implements the 5 special forms as data-structures:</p></div><div><div class="highlight"><pre>  <span class="p">(</span><span class="kd">defmacro </span><span class="nv">continue</span> <span class="p">[</span><span class="o">&amp;</span> <span class="nv">body</span><span class="p">]</span>
    <span class="o">`</span><span class="p">{</span><span class="ss">::type</span> <span class="ss">:continue</span> <span class="ss">::value</span> <span class="p">(</span><span class="k">do </span><span class="o">~@</span><span class="nv">body</span><span class="p">)})</span>

  <span class="p">(</span><span class="kd">defmacro </span><span class="nv">default</span> <span class="p">[</span><span class="o">&amp;</span> <span class="nv">args</span><span class="p">]</span>
    <span class="o">`</span><span class="p">{</span><span class="ss">::type</span> <span class="ss">:default</span> <span class="ss">::args</span> <span class="p">(</span><span class="nb">list </span><span class="o">~@</span><span class="nv">args</span><span class="p">)})</span>

  <span class="p">(</span><span class="kd">defmacro </span><span class="nv">choose</span> <span class="p">[</span><span class="nv">label</span> <span class="o">&amp;</span> <span class="nv">args</span><span class="p">]</span>
    <span class="o">`</span><span class="p">{</span><span class="ss">::type</span> <span class="ss">:choose</span> <span class="ss">::label</span> <span class="o">~</span><span class="nv">label</span> <span class="ss">::args</span> <span class="p">(</span><span class="nb">list </span><span class="o">~@</span><span class="nv">args</span><span class="p">)})</span>

  <span class="p">(</span><span class="kd">defmacro </span><span class="nv">fail</span>
    <span class="p">([]</span> <span class="p">{</span><span class="ss">::type</span> <span class="ss">:fail</span><span class="p">})</span>
    <span class="p">([</span><span class="nv">contents</span><span class="p">]</span>
       <span class="o">`</span><span class="p">{</span><span class="ss">::type</span> <span class="ss">:fail</span> <span class="ss">::contents</span> <span class="o">~</span><span class="nv">contents</span><span class="p">}))</span>
</pre></div>
</div><div><p><code>escalate</code> is not shown because it a bit more complex as options and defaults can. Essentially, it is still just a data structure.</p><p>The <code>raise</code> macro calls <code>raise-loop</code> which looks at the <code>::type</code> signature of the result returned by the <code>on</code> handler.</p></div><div><div class="highlight"><pre>  <span class="p">(</span><span class="kd">defn </span><span class="nv">raise-loop</span> <span class="p">[</span><span class="nv">issue</span> <span class="nv">managers</span> <span class="nv">optmap</span><span class="p">]</span>
    <span class="p">(</span><span class="nf">...</span> <span class="nv">code</span> <span class="nv">...</span>
         <span class="p">(</span><span class="nf">condp</span> <span class="nb">= </span><span class="p">(</span><span class="ss">::type</span> <span class="nv">res</span><span class="p">)</span>
           <span class="ss">:continue</span> <span class="p">(</span><span class="ss">::value</span> <span class="nv">res</span><span class="p">)</span>
           <span class="ss">:choose</span> <span class="p">(</span><span class="nf">raise-choose</span> <span class="nv">issue</span> <span class="p">(</span><span class="ss">::label</span> <span class="nv">res</span><span class="p">)</span> <span class="p">(</span><span class="ss">::args</span> <span class="nv">res</span><span class="p">)</span> <span class="nv">optmap</span><span class="p">)</span>
           <span class="ss">:default</span> <span class="p">(</span><span class="nf">raise-unhandled</span> <span class="nv">issue</span> <span class="nv">optmap</span><span class="p">)</span>
           <span class="ss">:fail</span> <span class="p">(</span><span class="nf">raise-fail</span> <span class="nv">issue</span> <span class="p">(</span><span class="ss">::contents</span> <span class="nv">res</span><span class="p">))</span>
           <span class="ss">:escalate</span> <span class="p">(</span><span class="nf">raise-escalate</span> <span class="nv">issue</span> <span class="nv">res</span> <span class="nv">managers</span> <span class="nv">optmap</span><span class="p">)</span>
           <span class="p">(</span><span class="nf">raise-catch</span> <span class="nv">mgr</span> <span class="nv">res</span><span class="p">)))</span>

    <span class="nv">...</span> <span class="nv">code</span> <span class="nv">...</span><span class="p">)</span>
</pre></div>
</div><div><p>In the case of <code>:continue</code>, it can be seen that the function just returns <code>&#40;::value res&#41;</code>. The function in which <code>raise</code> was called proceeds without ever jumping anywhere.</p><p>In the case of other forms, there are different handlers to handle each case. If the <code>on</code> handler returns a non-special form value, it will call <code>raise-catch</code>. So it is possible to mess with the internals of <code>ribol</code> by creating a datastructure of the same format of the special forms. However, please do it for shits and giggles only as I'm not sure what it would do to your program.</p></div><div><a name="implementing-catch"></a><h3><i>6.2.2 &nbsp;&nbsp; Implementing Catch</i></h3></div><div><p>To understand how <code>catch</code> is implemented, we have to look at the <code>manage</code> macro:</p></div><div><div class="highlight"><pre><span class="p">(</span><span class="kd">defmacro </span><span class="nv">manage</span>
  <span class="nv">...</span> <span class="nv">code</span> <span class="nv">...</span>

  <span class="o">`</span><span class="p">(</span><span class="nb">binding </span><span class="p">[</span><span class="nv">*managers*</span> <span class="p">(</span><span class="nb">cons </span><span class="o">~</span><span class="nv">manager</span> <span class="nv">*managers*</span><span class="p">)</span>
             <span class="nv">*optmap*</span> <span class="p">(</span><span class="nb">merge </span><span class="o">~</span><span class="nv">optmap</span> <span class="nv">*optmap*</span><span class="p">)]</span>
     <span class="p">(</span><span class="nf">try</span>
       <span class="o">~@</span><span class="nv">body-forms</span>
       <span class="p">(</span><span class="nf">catch</span> <span class="nv">clojure.lang.ExceptionInfo</span> <span class="o">~</span><span class="ss">&#39;ex</span>
         <span class="p">(</span><span class="nf">manage-signal</span> <span class="o">~</span><span class="nv">manager</span> <span class="o">~</span><span class="ss">&#39;ex</span><span class="p">))</span>
       <span class="o">~@</span><span class="nv">finally-forms</span><span class="p">)))</span>
</pre></div>
</div><div><p>So essentially, it is a <code>try/catch</code> block wrapped in an <code>binding</code> form.</p></div><div><p>When <code>raise-loop</code> gets a non-special form value back from a function handler in the manager it will call <code>raise-catch</code>, which will create a <code>catch</code> signal and actually throw it. The signal is just a clojure.lang.ExceptionInfo. The signal has a <code>::target</code>, which is the <code>:id</code> of the manager. It also has <code>::value</code>, which is the original result from <code>on</code>.</p></div><div><div class="highlight"><pre>  <span class="p">(</span><span class="kd">defn- </span><span class="nv">raise-catch</span> <span class="p">[</span><span class="nv">manager</span> <span class="nv">value</span><span class="p">]</span>
    <span class="p">(</span><span class="nf">throw</span> <span class="p">(</span><span class="nf">create-catch-signal</span> <span class="p">(</span><span class="ss">:id</span> <span class="nv">manager</span><span class="p">)</span> <span class="nv">value</span><span class="p">)))</span>

  <span class="p">(</span><span class="kd">defn- </span><span class="nv">create-catch-signal</span>
    <span class="p">[</span><span class="nv">target</span> <span class="nv">value</span><span class="p">]</span>
    <span class="p">(</span><span class="nf">ex-info</span> <span class="s">&quot;catch&quot;</span> <span class="p">{</span><span class="ss">::signal</span> <span class="ss">:catch</span> <span class="ss">::target</span> <span class="nv">target</span> <span class="ss">::value</span> <span class="nv">value</span><span class="p">}))</span>
</pre></div>
</div><div><p>Going back to the <code>manage</code> block, it can be seen that <code>manage</code> will catch any <code>clojure.lang.ExceptionInfo</code> objects thrown. When a signal is thrown from lower functions, it will be caught and <code>manage-signal</code> is then called. If the target does not match the :id, then the exception is rethrown. If the exception has <code>::signal</code> of <code>:catch</code> then the manager will return <code>&#40;::value data&#41;</code>.</p></div><div><div class="highlight"><pre><span class="p">(</span><span class="kd">defn </span><span class="nv">manage-signal</span> <span class="p">[</span><span class="nv">manager</span> <span class="nv">ex</span><span class="p">]</span>
    <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">data</span> <span class="p">(</span><span class="nf">ex-data</span> <span class="nv">ex</span><span class="p">)]</span>
      <span class="p">(</span><span class="nb">cond </span><span class="p">(</span><span class="nb">not= </span><span class="p">(</span><span class="ss">:id</span> <span class="nv">manager</span><span class="p">)</span> <span class="p">(</span><span class="ss">::target</span> <span class="nv">data</span><span class="p">))</span>
            <span class="p">(</span><span class="nf">throw</span> <span class="nv">ex</span><span class="p">)</span>

            <span class="nv">...</span> <span class="nv">choose</span> <span class="nv">code</span> <span class="nv">....</span>

            <span class="p">(</span><span class="nb">= </span><span class="ss">:catch</span> <span class="p">(</span><span class="ss">::signal</span> <span class="nv">data</span><span class="p">))</span>
            <span class="p">(</span><span class="ss">::value</span> <span class="nv">data</span><span class="p">)</span>

            <span class="ss">:else</span> <span class="p">(</span><span class="nf">throw</span> <span class="nv">ex</span><span class="p">))))</span>
</pre></div>
</div><div><a name="implementing-choose"></a><h3><i>6.2.3 &nbsp;&nbsp; Implementing Choose</i></h3></div><div><p>Choose works with options. It can be seen that apart from the <code>&#42;managers&#42;</code> structure, there is also an <code>&#42;optmap&#42;</code>. The optmap holds as the key/value pairs the labels of what options are registered and the id of the manager that provided the option.</p><p>Choose also requires that a signal be sent, but the target will now be a lookup on the optmap given an option label. The signal is very similar to the <code>catch</code> signal.</p></div><div><div class="highlight"><pre><span class="p">(</span><span class="kd">defn- </span><span class="nv">create-choose-signal</span>
    <span class="p">[</span><span class="nv">target</span> <span class="nv">label</span> <span class="nv">args</span><span class="p">]</span>
     <span class="p">(</span><span class="nf">ex-info</span> <span class="s">&quot;choose&quot;</span> <span class="p">{</span><span class="ss">::signal</span> <span class="ss">:choose</span> <span class="ss">::target</span> <span class="nv">target</span> <span class="ss">::label</span> <span class="nv">label</span> <span class="ss">::args</span> <span class="nv">args</span><span class="p">}))</span>
</pre></div>
</div><div><p>The part that processes <code>:choose</code> is shown in <code>manage-signal</code>:</p></div><div><div class="highlight"><pre> <span class="p">(</span><span class="kd">defn </span><span class="nv">manage-signal</span>
  <span class="nv">...</span>
       <span class="p">(</span><span class="nb">= </span><span class="ss">:choose</span> <span class="p">(</span><span class="ss">::signal</span> <span class="nv">data</span><span class="p">))</span>
       <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">label</span> <span class="p">(</span><span class="ss">::label</span> <span class="nv">data</span><span class="p">)</span>
             <span class="nv">f</span> <span class="p">(</span><span class="nb">get </span><span class="p">(</span><span class="ss">:options</span> <span class="nv">manager</span><span class="p">)</span> <span class="nv">label</span><span class="p">)</span>
             <span class="nv">args</span> <span class="p">(</span><span class="ss">::args</span> <span class="nv">data</span><span class="p">)]</span>
         <span class="p">(</span><span class="nf">manage-apply</span> <span class="nv">f</span> <span class="nv">args</span> <span class="nv">label</span><span class="p">))</span>
  <span class="nv">...</span><span class="p">)</span>
</pre></div>
</div><div><a name="implementing-the-rest"></a><h3><i>6.2.4 &nbsp;&nbsp; Implementing the Rest</i></h3></div><div><p><code>fail</code>, <code>default</code>, <code>escalate</code> all use similar <em>data as control-flow</em> mechanisms to allow control to be directed to the correct part of the program. It is through this mechanism that branching in the <code>on</code> handlers can be achieved.</p></div><div><a name="end-notes"></a><h2><b>7 &nbsp;&nbsp; End Notes</b></h2></div><div><p>For any feedback, requests and comments, please feel free to lodge an issue on github or contact me directly.</p><p>Chris.</p></div></section></body><script type="text/javascript">var metas = document.getElementsByTagName('meta');
var i;
if (navigator.userAgent.match(/iPhone/i)) {
  for (i=0; i<metas.length; i++) {
    if (metas[i].name == "viewport") {
      metas[i].content = "width=device-width, minimum-scale=1.0, maximum-scale=1.0";
    }
  }
  document.addEventListener("gesturestart", gestureStart, false);
}
function gestureStart() {
  for (i=0; i<metas.length; i++) {
    if (metas[i].name == "viewport") {
      metas[i].content = "width=device-width, minimum-scale=0.25, maximum-scale=1.6";
    }
  }
}</script></html>